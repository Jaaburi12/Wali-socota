<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Laam wallet</title>
    <!-- Favicon & OG Image -->
    <link rel="icon" type="image/png" href="https://i.ibb.co/r28SP1bN/20250802-225108.png">
    <link rel="apple-touch-icon" href="https://i.ibb.co/r28SP1bN/20250802-225108.png">
    <meta property="og:image" content="https://i.ibb.co/r28SP1bN/20250802-225108.png">
    <meta property="og:title" content="Laam wallet - Modern Digital Currency">
    <meta property="og:description" content="Laam Token is a digital asset built on Stellar with a fixed supply.">
    <meta property="og:url" content="https://laam.online">
    <meta property="og:type" content="website">
<!-- Android PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1976d2">

<!-- iPhone / iPad PWA -->
<link rel="apple-touch-icon" href="https://i.ibb.co/r28SP1bN/20250802-225108.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Laam Wallet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/stellar-sdk/10.4.0/stellar-sdk.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<!-- Add Chart.js for beautiful charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
 /* Fingerprint Sensor Styles */
  .fingerprint-section {
    margin: 25px 0;
    padding: 20px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .fingerprint-btn {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
  }
  
  .fingerprint-btn:hover {
    background: linear-gradient(135deg, #059669, #047857);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
  }
  
  .fingerprint-btn:disabled {
    background: #6b7280;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }
  
  .fingerprint-icon {
    font-size: 20px;
  }
  
  .biometric-options {
    display: flex;
    gap: 10px;
    margin-top: 15px;
  }
  
  .biometric-option {
    flex: 1;
    padding: 12px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    color: var(--text);
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    font-size: 14px;
  }
  
  .biometric-option:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: var(--brand);
  }
  
  .biometric-option.active {
    background: rgba(124, 58, 237, 0.2);
    border-color: var(--brand);
  }
  
  .setup-fingerprint-btn {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, #7c3aed, #6d28d9);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 10px;
  }
  
  .setup-fingerprint-btn:hover {
    background: linear-gradient(135deg, #6d28d9, #5b21b6);
    transform: translateY(-2px);
  }
  
  .fingerprint-status {
    text-align: center;
    margin: 15px 0;
    padding: 12px;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
  }
  
  .fingerprint-status.enabled {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
    border: 1px solid rgba(16, 185, 129, 0.3);
  }
  
  .fingerprint-status.disabled {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
    border: 1px solid rgba(239, 68, 68, 0.3);
  }
  
  .fingerprint-scanner {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 10000;
    align-items: center;
    justify-content: center;
    flex-direction: column;
  }
  
  .fingerprint-scanner.active {
    display: flex;
  }
  
  .scanner-container {
    background: var(--card);
    border-radius: 20px;
    padding: 40px;
    text-align: center;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    border: 1px solid var(--line);
    max-width: 400px;
    width: 90%;
  }
  
  .scanner-animation {
    width: 120px;
    height: 120px;
    border: 3px solid var(--brand);
    border-radius: 50%;
    position: relative;
    margin: 0 auto 30px;
    animation: pulse 2s infinite;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .scanner-animation::before {
    content: 'üñêÔ∏è';
    font-size: 40px;
    position: absolute;
  }
  
  .scanner-animation.scanning::before {
    content: 'üëá';
    animation: fingerprintScan 1.5s infinite;
  }
  
  @keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.05); opacity: 0.8; }
    100% { transform: scale(1); opacity: 1; }
  }
  
  @keyframes fingerprintScan {
    0% { transform: translateY(0); }
    50% { transform: translateY(10px); }
    100% { transform: translateY(0); }
  }
  
  .scanner-text {
    color: white;
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 10px;
  }
  
  .scanner-subtext {
    color: var(--muted);
    font-size: 14px;
    margin-bottom: 30px;
  }
  
  .cancel-scan {
    background: rgba(239, 68, 68, 0.8);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 10px;
    font-size: 16px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  
  .cancel-scan:hover {
    background: rgba(239, 68, 68, 1);
  }
  
  .device-support-info {
    margin-top: 15px;
    font-size: 12px;
    color: var(--muted);
    text-align: center;
  }
  
  .supported-devices {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-top: 15px;
  }
  
  .device-item {
    padding: 8px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    font-size: 12px;
    text-align: center;
  }
  :root{
    /* Modern Purple & Dark Theme */
    --bg1: #0f0f23;
    --bg2: #1a1a2e;
    --card: rgba(26, 26, 46, 0.8);
    --text: #f0f0f0;
    --muted: #a0a0c0;
    --brand: #7c3aed;
    --brand2: #6d28d9;
    --line: rgba(255, 255, 255, 0.1);
    --ok: #10b981;
    --warn: #f59e0b;
    --err: #ef4444;
    --maxw: 920px;
    --rad: 20px;
  }
  
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    color: var(--text);
    background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px 14px;
    position: relative;
    overflow-x: hidden;
  }
  
  body::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
      radial-gradient(circle at 10% 20%, rgba(124, 58, 237, 0.1) 0%, transparent 20%),
      radial-gradient(circle at 90% 80%, rgba(16, 185, 129, 0.1) 0%, transparent 20%),
      radial-gradient(circle at 50% 50%, rgba(245, 158, 11, 0.05) 0%, transparent 50%);
    z-index: -1;
  }
  
  .app {
    width: 100%;
    max-width: 450px;
    text-align: center;
    position: relative;
    z-index: 1;
  }
  
  /* Logo and Header Styles */
  .logo-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin-bottom: 40px;
    position: relative;
  }
  
  .logo-container::after {
    content: "";
    position: absolute;
    bottom: -15px;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 3px;
    background: linear-gradient(90deg, transparent, var(--brand), transparent);
    border-radius: 3px;
  }
  
  .logo-container img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    box-shadow: 0 8px 25px rgba(124, 58, 237, 0.3);
    transition: transform 0.3s ease;
  }
  
  .logo-container img:hover {
    transform: scale(1.05);
  }
  
  h1 {
    margin: 0;
    font-size: 3rem;
    font-weight: 800;
    background: linear-gradient(135deg, #7c3aed, #10b981);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 2px 10px rgba(124, 58, 237, 0.3);
  }
  
  /* Import Card Styles */
  .import-card {
    background: rgba(26, 26, 46, 0.8);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--rad);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
    padding: 40px 30px;
    margin: 0 auto;
    max-width: 100%;
    position: relative;
    overflow: hidden;
  }
  
  .import-card::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--brand), var(--ok));
  }
  
  .form-group {
    margin-bottom: 24px;
    text-align: left;
  }
  
  .form-label {
    display: block;
    font-size: 16px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 10px;
    padding-left: 5px;
  }
  
  .form-input {
    width: 100%;
    padding: 16px 18px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    font-size: 16px;
    background: rgba(15, 15, 35, 0.7);
    color: var(--text);
    outline: none;
    transition: all 0.3s ease;
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
  }
  
  .form-input:focus {
    border-color: var(--brand);
    background: rgba(15, 15, 35, 0.9);
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
  }
  
  .form-input::placeholder {
    color: var(--muted);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  }
  
  .import-button {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, var(--brand), var(--brand2));
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
    margin-top: 16px;
    position: relative;
    overflow: hidden;
  }
  
  .import-button::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
  }
  
  .import-button:hover::before {
    left: 100%;
  }
  
  .import-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(124, 58, 237, 0.5);
  }
  
  .divider {
    margin: 32px 0;
    text-align: center;
    position: relative;
  }
  
  .divider::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: rgba(255, 255, 255, 0.1);
  }
  
  .divider-text {
    background: var(--card);
    padding: 0 16px;
    color: var(--muted);
    font-size: 14px;
    font-weight: 500;
  }
  
  .generate-link {
    text-align: center;
  }
  
  .generate-button {
    color: var(--brand);
    text-decoration: none;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: color 0.3s ease;
    text-transform: none;
    padding: 0;
    width: auto;
    box-shadow: none;
  }
  
  .generate-button:hover {
    color: var(--brand2);
  }
  
  .note-text {
    font-size: 12px;
    color: var(--muted);
    margin-top: 8px;
    line-height: 1.4;
  }

  /* Key Display Modal */
  .key-modal {
    display: none;
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }
  
  .key-modal.show {
    display: flex;
  }
  
  .key-modal-content {
    background: var(--card);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--rad);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    padding: 40px 30px;
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    backdrop-filter: blur(10px);
    position: relative;
  }
  
  .key-modal-content::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--brand), var(--ok));
    border-radius: var(--rad) var(--rad) 0 0;
  }
  
  .key-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
  }
  
  .key-modal-title {
    font-size: 1.8rem;
    font-weight: 700;
    background: linear-gradient(135deg, var(--brand), var(--ok));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin: 0;
  }
  
  .key-modal-close {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    font-size: 2rem;
    cursor: pointer;
    color: var(--muted);
    padding: 5px;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }
  
  .key-modal-close:hover {
    color: var(--text);
    background: rgba(255, 255, 255, 0.2);
  }
  
  .key-display-group {
    margin-bottom: 30px;
  }
  
  .key-display-label {
    display: block;
    font-size: 16px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 12px;
  }
  
  .key-display-container {
    position: relative;
    display: flex;
    align-items: center;
  }
  
  .key-display-input {
    width: 100%;
    padding: 15px 60px 15px 15px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    font-size: 14px;
    background: rgba(15, 15, 35, 0.7);
    color: var(--text);
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
    word-break: break-all;
    resize: none;
  }
  
  .copy-btn {
    position: absolute;
    right: 10px;
    background: var(--brand);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);
  }
  
  .copy-btn:hover {
    background: var(--brand2);
    box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4);
    transform: translateY(-1px);
  }
  
  .copy-btn.copied {
    background: var(--ok);
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
  }
  
  .warning-text {
    background: rgba(245, 158, 11, 0.1);
    border: 1px solid rgba(245, 158, 11, 0.3);
    border-radius: 12px;
    padding: 15px;
    margin: 20px 0;
    color: var(--warn);
    font-size: 14px;
    line-height: 1.5;
  }
  
  .use-account-btn {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, var(--ok), #059669);
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 700;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
    position: relative;
    overflow: hidden;
  }
  
  .use-account-btn::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
  }
  
  .use-account-btn:hover::before {
    left: 100%;
  }
  
  .use-account-btn:hover {
    background: linear-gradient(135deg, #059669, #047857);
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    transform: translateY(-2px);
  }
  /* Main Card Styles */
  .card{
    background:var(--card); border:1px solid var(--line); border-radius:var(--rad);
    box-shadow:0 10px 30px rgba(0,0,0,0.1); padding:22px; margin:14px auto;
  }
  .grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  @media (max-width:820px){ .grid-2{ grid-template-columns:1fr; } }
  label{ display:block; text-align:left; margin:8px 0 6px; font-weight:600; color:var(--brand); }
  input,select,button{
    width:100%; padding:12px 14px; border:1px solid var(--line); border-radius:12px; font-size:1rem;
    background:#f8f9fa; color:var(--text); outline:none; transition:border-color .2s ease;
  }
  input:focus{ border-color:var(--brand); }
  button{
    background:var(--brand); color:#fff; font-weight:700; letter-spacing:.02em; border:none;
    box-shadow:0 4px 14px rgba(0,82,204,0.3); cursor:pointer; text-transform:uppercase; transition:all .2s ease;
  }
  button:hover{ background:var(--brand2); box-shadow:0 6px 18px rgba(0,65,163,0.4); transform:translateY(-2px); }
  button:disabled{ background:#b0bec5; cursor:not-allowed; box-shadow:none; transform:none; }
  .btn-secondary{ background:#6c757d; color:#fff; box-shadow:0 4px 14px rgba(0,0,0,0.1); }
  .btn-secondary:hover{ background:#5a6268; }
  .btn-danger{ background:var(--err); color:#fff; box-shadow:0 4px 14px rgba(220,53,69,0.3); }
  .btn-danger:hover{ background:#c82333; }
  .mono{
    font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
    background:#e9ecef; padding:10px 12px; border-radius:12px; overflow-wrap:anywhere; color:#343a40;
  }
  .muted{ color:var(--muted); font-size:.92rem; }
  .balances{ display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; }
  .pill{ background:#e9ecef; border:1px solid var(--line); padding:8px 14px; border-radius:999px; font-weight:600; }
  .hidden{ display:none; }
  .send-wrap{ display:none; margin-top:16px; text-align:left; border-top:1px solid var(--line); padding-top:16px; }
  .send-row{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  @media (max-width:640px){ .send-row{ grid-template-columns:1fr; } }

  /* Trade Section Styles */
   .trade-card {
    padding: 0;
    overflow: hidden;
    position: relative;
  }
  
  .trade-card::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--brand), var(--ok));
    border-radius: var(--rad) var(--rad) 0 0;
  }
  
  .trade-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid var(--line);
    width: 100%;
  }
.left-icons, .right-icons {
  display: flex;
  align-items: center;
}

.trade-header h3 {
  margin: 0;
}
  .trade-asset-selector{ display:flex; align-items:center; justify-content:space-between; padding:16px 20px; background: black; }
  .asset-box{ display:flex; align-items:center; gap:8px; }
  .asset-box img{ width:24px; height:24px; border-radius:50%; }
  .asset-box .asset-name{ font-weight:600; }
  .asset-box .asset-issuer{ font-size:.8rem; color:var(--muted); }
  .swap-icon{ font-size:1.5rem; background: black; border-radius:50%; padding:5px; border:1px solid var(--line); cursor:pointer; transition:all 0.3s ease; }
  .swap-icon:hover{ background:var(--brand); color: black; transform:rotate(180deg); }
  .trade-tabs{ display:flex; border-bottom:1px solid var(--line); background: black; }
  .trade-tabs .tab{ 
    flex:1; padding:12px; text-align:center; cursor:pointer; font-weight:600; 
    color:var(--muted); border-bottom:3px solid transparent; 
    transition:all 0.3s ease; position:relative;
  }
  .trade-tabs .tab:hover{ background:rgba(0,82,204,0.1); color:var(--brand); }
  .trade-tabs .tab.active{ color:var(--brand); border-bottom-color:var(--brand); background: black; }
  .tab-content{ display:none; }
  .tab-content.active{ display:block; }
  .overview-content{ padding:20px; text-align:center; }
  .price-display {
  font-size: 2.5rem;
  font-weight: bold;
  margin-bottom: 10px;
  color: white; /* qoraalka weyn madow */
}

.price-change {
  font-size: 1rem;
  margin-bottom: 20px;
  color: black; /* qoraalka madow */
}

.price-change.positive {
  color: white; /* halkii cagaar */
}

.price-change.negative {
  color: white; /* halkii cas */
}

.chart-timeframes {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 20px;
}

.timeframe-btn { 
  padding: 8px 15px;
  border-radius: 8px;
  border: 1px solid var(--line);
  background: white;
  color: black; /* qoraalka madow */
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.9rem;
  font-weight: 600;
}

.timeframe-btn:hover,
.timeframe-btn.active {
  background: var(--brand);
  color: black; /* qoraalka madow xitaa marka la doorto */
  border-color: var(--brand);
}

.chart-container {
  width: 100%; 
  height: 200px; 
  margin-bottom: 20px;
  position: relative;
}
  .market-stats{ display:grid; grid-template-columns:1fr 1fr; gap:15px; text-align:left; }
  .stat-item{ background: black; padding:12px; border-radius:8px; border:1px solid var(--line); }
  .stat-label{ font-size:0.8rem; color:var(--muted); margin-bottom:4px; }
  .stat-value{ font-weight:600; color:var(--text); }
  .orderbook-content{ padding:10px 20px 20px; }
  .orderbook-table{ width:100%; border-collapse:collapse; margin-bottom:10px; }
  .orderbook-table th,.orderbook-table td{ text-align:right; padding:8px 4px; font-size:.9rem; }
  .orderbook-table th{ color:var(--muted); font-weight:600; border-bottom:2px solid var(--line); }
  .orderbook-table th:first-child,.orderbook-table td:first-child{ text-align:left; }
  .orderbook-table .bid-row{ cursor:pointer; transition:background 0.2s ease; }
  .orderbook-table .bid-row:hover{ background:rgba(40,167,69,0.1); }
  .orderbook-table .bid-row td:nth-child(2){ color:var(--ok); font-weight:600; }
  .orderbook-table .ask-row{ cursor:pointer; transition:background 0.2s ease; }
  .orderbook-table .ask-row:hover{ background:rgba(220,53,69,0.1); }
  .orderbook-table .ask-row td:nth-child(2){ color:var(--err); font-weight:600; }
  .spread{ 
    padding:12px 0; text-align:center; font-weight:bold; 
    border-top:1px solid var(--line); border-bottom:1px solid var(--line); 
    margin:8px 0; background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%); border-radius:8px;
  }
  .trades-content{ padding:10px 20px 20px; }
  .trades-table{ width:100%; border-collapse:collapse; }
  .trades-table th,.trades-table td{ text-align:right; padding:8px 4px; font-size:.9rem; }
  .trades-table th{ color:var(--muted); font-weight:600; border-bottom:2px solid var(--line); }
  .trades-table th:first-child,.trades-table td:first-child{ text-align:left; }
  .trade-buy{ color:var(--ok); }
  .trade-sell{ color:var(--err); }
  .trade-time{ color:var(--muted); font-size:0.8rem; }
  .trade-actions{ display:flex; gap:15px; padding:20px; background:#f8f9fa; border-top:1px solid var(--line); }
  .trade-actions button{ 
    flex:1; padding:16px; font-size:1.1rem; border-radius:12px; text-transform:uppercase; 
    font-weight:700; transition:all 0.3s ease; position:relative; overflow:hidden;
  }
  .trade-actions button:before{
    content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
    background:linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition:left 0.5s; z-index:1;
  }
  .trade-actions button:before{
    content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
    background:linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition:left 0.5s; z-index:1;
  }
  .trade-actions button:hover:before{ left:100%; }
  .btn-buy{ background:var(--ok); box-shadow:0 4px 14px rgba(40,167,69,0.3); }
  .btn-buy:hover{ background:#218838; box-shadow:0 6px 20px rgba(40,167,69,0.4); transform:translateY(-2px); }
  .btn-sell{ background:var(--err); color:#fff; box-shadow:0 4px 14px rgba(220,53,69,0.3); }
  .btn-sell:hover{ background:#c82333; box-shadow:0 6px 20px rgba(220,53,69,0.4); transform:translateY(-2px); }
  .loading-spinner{ 
    display:inline-block; width:20px; height:20px; 
    border:3px solid #f3f3f3; border-top:3px solid var(--brand); 
    border-radius:50%; animation:spin 1s linear infinite; 
  }
  @keyframes spin{ 0%{ transform:rotate(0deg); } 100%{ transform:rotate(360deg); } }

  /* Modal Styles */
  .trade-modal{ display:none; position:fixed; inset:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center; }
  .trade-modal.show{ display:flex; }
  .modal-content{ 
    background:var(--card); border:1px solid var(--line); border-radius:var(--rad); 
    box-shadow:0 20px 40px rgba(0,0,0,0.15); padding:20px; max-width:420px; width:90%; 
    max-height:90vh; overflow-y:auto; animation:modalSlideIn 0.3s ease-out;
  }
  @keyframes modalSlideIn{ from{ opacity:0; transform:translateY(-50px); } to{ opacity:1; transform:translateY(0); } }
  .modal-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
  .modal-title{ font-size:1.5rem; font-weight:700; color:var(--brand); margin:0; }
  .modal-close{ 
    background:none; border:none; font-size:1.5rem; cursor:pointer; color:var(--muted); 
    padding:5px; width:auto; height:auto; box-shadow:none; text-transform:none; 
    border-radius:50%; transition:all 0.3s ease;
  }
  .modal-close:hover{ color:var(--text); background:rgba(0,0,0,0.1); transform:none; box-shadow:none; }
  .panel{ background:#f8f9fa; border:1px solid var(--line); border-radius:12px; padding:20px; margin:0; }
  .titleRow{ display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
  .title{ font-size:1.2rem; font-weight:700; color:var(--brand); }
  .avail{ font-size:.9rem; color:var(--muted); }
  .field{ margin-bottom:16px; }
  .inputWrap{ position:relative; display:flex; align-items:center; }
  .inputWrap input{ padding-right:60px; margin:0; border:2px solid var(--line); transition:border-color 0.3s ease; }
  .inputWrap input:focus{ border-color:var(--brand); box-shadow:0 0 0 3px rgba(0,82,204,0.1); }
  .unit{ position:absolute; right:12px; color:var(--muted); font-weight:600; pointer-events:none; }
  .hint{ font-size:.8rem; color:var(--muted); margin-top:4px; text-align:left; }
  .rowBtns{ display:flex; gap:8px; margin-top:8px; }
  .rowBtns button{ 
    flex:1; padding:8px 12px; font-size:.7rem; background: Green; color:var(--text); 
    border:1px solid var(--line); text-transform:none; font-weight:600; border-radius:6px;
    transition:all 0.3s ease;
  }
  .rowBtns button:hover{ background:var(--brand); color: black; transform:translateY(-1px); }
  .totalBox{ margin-bottom:20px; }
  .totalBox input{ background: black; color:var(--muted); }
  .cta{ 
    padding:16px; font-size:1.1rem; font-weight:700; text-transform:uppercase; margin:0; 
    border-radius:12px; transition:all 0.3s ease; position:relative; overflow:hidden;
  }
  .cta:before{
    content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
    background:linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition:left 0.5s; z-index:1;
  }
  .cta:hover:before{ left:100%; }
  .cta.buy{ background:var(--ok); box-shadow:0 4px 14px rgba(40,167,69,0.3); }
  .cta.buy:hover{ background:#218838; box-shadow:0 6px 20px rgba(40,167,69,0.4); transform:translateY(-2px); }
  .cta.sell{ background:var(--err); color: black; box-shadow:0 4px 14px rgba(220,53,69,0.3); }
  .cta.sell:hover{ background:#c82333; box-shadow:0 6px 20px rgba(220,53,69,0.4); transform:translateY(-2px); }
/* Fix for Buy/Sell Laam buttons and input text visibility */
.btn-buy { 
    background: linear-gradient(135deg, #10b981, #059669) !important; 
    color: white !important;
    box-shadow: 0 4px 14px rgba(16, 185, 129, 0.3) !important;
    border: none !important;
}

.btn-buy:hover { 
    background: linear-gradient(135deg, #059669, #047857) !important;
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4) !important; 
    transform: translateY(-2px) !important;
}

.btn-sell { 
    background: linear-gradient(135deg, #ef4444, #dc2626) !important; 
    color: white !important;
    box-shadow: 0 4px 14px rgba(239, 68, 68, 0.3) !important;
    border: none !important;
}

.btn-sell:hover { 
    background: linear-gradient(135deg, #dc2626, #b91c1c) !important;
    box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4) !important; 
    transform: translateY(-2px) !important;
}

/* Fix input text visibility in trade modal */
.trade-modal input {
    background: white !important;
    color: #333 !important;
    border: 1px solid #ddd !important;
}

.trade-modal input:focus {
    border-color: var(--brand) !important;
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2) !important;
}

.trade-modal .unit {
    color: #666 !important;
}

.trade-modal .totalBox input {
    background: #f8f9fa !important;
    color: #333 !important;
    border: 1px solid #ddd !important;
}

.trade-modal .hint {
    color: #666 !important;
}

.trade-modal .avail {
    color: #666 !important;
}

   /* My Orders Modal Styles */
  .my-orders-modal {
    display: none;
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }
  
  .my-orders-modal.show {
    display: flex;
  }
  
  .my-orders-modal-content {
    background: var(--card);
    border: 1px solid var(--line);
    border-radius: var(--rad);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    padding: 30px;
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
  }
  
  .my-orders-modal-content::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--brand), var(--ok));
    border-radius: var(--rad) var(--rad) 0 0;
  }
  
  .my-orders-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
  }
  
  .my-orders-modal-title {
    font-size: 1.5rem;
    font-weight: 700;
    background: linear-gradient(135deg, var(--brand), var(--ok));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin: 0;
  }
  
  .my-orders-modal-close {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    font-size: 1.8rem;
    cursor: pointer;
    color: var(--muted);
    padding: 5px;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }
  
  .my-orders-modal-close:hover {
    color: var(--text);
    background: rgba(255, 255, 255, 0.2);
  }
  
  .orders-list {
    max-height: 300px;
    overflow-y: auto;
    margin-bottom: 20px;
  }
  
  .order-item {
    display: flex;
    justify-content: space-between;
    padding: 12px;
    border: 1px solid var(--line);
    border-radius: 8px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    background: rgba(15, 15, 35, 0.7);
  }
  
  .order-item:hover {
    background-color: rgba(124, 58, 237, 0.1);
  }
  
  .order-item.selected {
    border-color: var(--brand);
    background-color: rgba(124, 58, 237, 0.2);
  }
  
  .order-type {
    font-weight: 700;
    text-transform: uppercase;
    font-size: 12px;
  }
  
  .order-type.buy {
    color: var(--ok);
  }
  
  .order-type.sell {
    color: var(--err);
  }
  
  .order-amount, .order-price {
    font-family: 'SF Mono', monospace;
  }
  
  .order-actions {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  
  .order-action-btn {
    width: 100%;
    padding: 15px;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: none;
    position: relative;
    overflow: hidden;
  }
  
  .order-action-btn::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
  }
  
  .order-action-btn:hover::before {
    left: 100%;
  }
  
  .edit-order-btn {
    background: var(--brand);
    color: white;
    box-shadow: 0 4px 16px rgba(124, 58, 237, 0.3);
  }
  
  .edit-order-btn:hover {
    background: var(--brand2);
    box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
    transform: translateY(-2px);
  }
  
  .cancel-order-btn {
    background: var(--err);
    color: white;
    box-shadow: 0 4px 16px rgba(239, 68, 68, 0.3);
  }
  
  .cancel-order-btn:hover {
    background: #dc2626;
    box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
    transform: translateY(-2px);
  }
/* Fix for Edit Order Modal Inputs */
#editOrderModal input {
    background: white !important;
    color: #333 !important;
    border: 1px solid #ddd !important;
}

#editOrderModal input:focus {
    border-color: var(--brand) !important;
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2) !important;
}

#editOrderModal .panel {
    background: #f8f9fa !important;
}

#editOrderModal label {
    color: #333 !important;
}

  /* Animation */
  .import-card {
    animation: slideUp 0.6s ease-out;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (max-width: 480px) {
    .app {
      max-width: 100%;
      padding: 0 10px;
    }
    
    .import-card {
      padding: 30px 20px;
      margin: 10px;
    }
    
    .logo-container img {
      width: 60px;
      height: 60px;
    }
    
    h1 {
      font-size: 2.2rem;
    }

    .key-modal-content {
      padding: 30px 20px;
      margin: 10px;
    }

    .key-display-input {
      font-size: 12px;
      padding: 12px 50px 12px 12px;
    }

    .copy-btn {
      padding: 6px 8px;
      font-size: 10px;
    }

    .market-stats {
      grid-template-columns: 1fr;
    }

    .chart-timeframes {
      flex-wrap: wrap;
    }
  }

  /* New UI Elements for the Wallet */
.wallet-container {
    background: white;
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }
  
.total-assets {
  background: linear-gradient(135deg, #2196f3, #21cbf3);
  color: white;
  border-radius: 20px;
  padding: 20px 30px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
  text-align: center;
  max-width: 250px;
  margin: 20px auto;
  transition: transform 0.3s, box-shadow 0.3s;
}

.total-assets:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
}

.total-label {
  font-size: 14px;
  font-weight: 500;
  opacity: 0.9;
}

.total-value {
  font-size: 36px;
  font-weight: bold;
  margin-top: 8px;
  letter-spacing: 1px;
}

.action-buttons {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .action-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            julstify-content: center;
            padding: 15px;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
            cursor: pointer;
            border: 1px solid #eee;
        }
        
        .action-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
        }
        
        .action-button.send {
            background: linear-gradient(135deg, #1976d2, #2196f3);
            color: white;
        }
        
        .action-button.receive {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }
        
        
        .action-button.trustline {
            background: linear-gradient(135deg, #fd7e14, #ffc107);
            color: white;
        }
        
        .action-button.lock {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
            
        }
        
        .action-icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }
        
        .action-text {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .footer {
            padding: 20px;
            text-align: center;
            color: #777;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
        }
        
        .highlight {
            color: #2196f3;
            font-weight: 600;
        }
        

  /* Send Button */
  .send-btn {
    background: #1976d2;
    color: white;
    padding: 10px 16px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.3s;
  }
  .send-btn:hover {
    background: #1565c0;
  }

    /* Overlay */
wizardOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

/* Modal wrap */
.send-wrap {
  background: linear-gradient(45deg, #FFD700, #FFDF00, #FFC700);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 20px;
  max-width: 420px;
  width: 90%;
  color: #fff;
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  position: relative;
  animation: fadeIn .3s ease;
}

/* Close button */
#sendWizard  {
  position: absolute;
  top: 12px;
  right: 12px;
  background: Silver;
  border: none;
  font-size: 22px;
  color: #fff;
  cursor: pointer;
}

/* Steps */
#sendWizard h3 {
  margin-bottom: 15px;
  font-size: 20px;
  font-weight: 600;
}

#sendWizard input, 
#sendWizard select {
  width: 100%;
  padding: 10px 12px;
  margin: 10px 0;
  border-radius: 10px;
  border: none;
  outline: none;
  background: rgba(255,255,255,0.1);
  color: #fff;
}
#confirmDest {
  display: inline-block;
  word-break: break-all;   /* jebin xaraf kasta haddii uu dhaafo */
  overflow-wrap: anywhere; /* taageero dheeraad ah */
  max-width: 100%;         /* ha ka bixin box-kiisa */
}
/* Button group */
.btn-group {
  display: flex;
  justify-content: space-between;
  gap: 10px;
  margin-top: 15px;
}

.wizard-btn {
  flex: 1;
  padding: 10px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s ease;
}

.wizard-btn.primary {
  background: #007aff;
  color: #fff;
}
.wizard-btn.primary:hover {
  background: #005fcc;
}

.wizard-btn.secondary {
  background: rgba(255,255,255,0.15);
  color: #fff;
}
.wizard-btn.secondary:hover {
  background: rgba(255,255,255,0.25);
}

.wizard-btn.confirm {
  background: #4cd964;
  color: #fff;
}
.wizard-btn.confirm:hover {
  background: #38b64c;
}
/* Animation */
@keyframes fadeIn {
  from {opacity: 0; transform: translateY(20px);}
  to {opacity: 1; transform: translateY(0);}
    }

        @media (max-width: 480px) {
            .header {
                padding: 20px;
            }    

.assets-grid {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.asset-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #111827;
  border-radius: 12px;
  padding: 12px 16px;
  color: #fff;
}

.asset-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.asset-icon img {
  width: 32px;
  height: 32px;
  border-radius: 50%;
}

.asset-details .asset-name {
  font-weight: bold;
  font-size: 14px;
}

.asset-details .asset-price {
  font-size: 12px;
  color: #9ca3af;
}

.price-change.positive { color: #22c55e; }
.price-change.negative { color: #ef4444; }

.asset-right {
  text-align: right;
}

.asset-balance {
  font-size: 14px;
  font-weight: bold;
}

.asset-balance-sub {
  font-size: 12px;
  color: #9ca3af;
}
        
     /* Token Modal Styles */
  .token-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
    z-index: 1000;
    justify-content: center;
    align-items: center;
  }

  .token-modal.show {
    display: flex;
  }

  .token-modal-content {
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    width: 85%;
    max-width: 400px;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    animation: modalAppear 0.3s ease-out;
  }

  @keyframes modalAppear {
    from { transform: translateY(50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .token-modal-header {
    padding: 20px;
    text-align: center;
    background: rgba(0, 0, 0, 0.2);
  }

  .token-modal-header h2 {
    font-size: 22px;
    margin-bottom: 5px;
    color: white;
  }

  .token-modal-body {
    padding: 25px;
  }

  .token-info {
    display: flex;
    align-items: center;
    margin-bottom: 25px;
  }

  .token-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
  }

  .token-icon img {
    width: 70%;
    height: 70%;
    object-fit: contain;
  }

  .token-details h3 {
    font-size: 24px;
    margin-bottom: 5px;
    color: white;
  }

  .token-details p {
    color: #a0a0a0;
  }

  .token-modal-actions {
    display: flex;
    gap: 15px;
  }

  .token-modal-btn {
    flex: 1;
    padding: 16px 0;
    border-radius: 12px;
    border: none;
    font-weight: 600;
    font-size: 18px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.1);
    color: white;
  }

  .token-modal-btn i {
    font-size: 24px;
    margin-bottom: 8px;
  }

  .token-modal-btn.send {
    background: #e74c3c;
  }

  .token-modal-btn.receive {
    background: #2ecc71;
  }

  .token-modal-btn:active {
    transform: scale(0.95);
  }

  .close-token-modal {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.1);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

  .close-token-modal i {
    font-size: 24px;
    color: white;
  }
  
  /* Hover effect for asset items */
  .asset-item {
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .asset-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.4);
  }
  .custom-alert {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #28a745;
    color: black;
    padding: 14px 22px;
    border-radius: 12px;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    z-index: 9999;
    display: none;
    animation: fadeInUp 0.4s ease;
  }
  
  @keyframes fadeInUp {
    from { opacity: 0; transform: translate(-50%, 20px); }
    to { opacity: 1; transform: translate(-50%, 0); }
  }

/* ==== Custom Dark Wallet Design (Mockup Style) ==== */
.wallet-container {
  background: rgba(0, 0, 0, 0.85);
  border-radius: 20px;
  padding: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.6);
  margin-bottom: 20px;
}
.total-assets {
  padding: 15px 20px;
  border-radius: 12px;
  color: white;
  font-weight: 600;
  font-family: sans-serif;
  text-align: center;

  /* Gradient background: black */
  background: linear-gradient(135deg, #000000, );
  
  /* Shadow for depth */
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.total-assets .total-label {
  font-size: 14px;
  margin-bottom: 6px;
}

.total-assets .total-value {
  font-size: 20px;
}

.assets-grid {
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.asset-item {
  background: rgba(255,255,255,0.05);
  border-radius: 16px;
  padding: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}
.asset-name {
  font-weight: 600;
  font-size: 16px;
  color: #fff;
}
.asset-price {
  font-size: 13px;
  color: #aaa;
}

.action-button {
  flex: 1;
  padding: 14px;
  border-radius: 14px;
  text-align: center;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(0,0,0,0.4);
  color: #fff;
}
.action-button.send {
  background: linear-gradient(135deg, #ff416c, #ff4b2b);
}
.action-button.receive {
  background: linear-gradient(135deg, #11998e, #38ef7d);
}
.action-button.trustline {
  background: linear-gradient(135deg, #f7971e, #ffd200);
  color: #000;
}
.action-button.lock {
  background: linear-gradient(135deg, #283c86, #45a247);
}


/* ==== Background Gradient ==== */
body::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
      radial-gradient(circle at 10% 20%, rgba(124, 58, 237, 0.1) 0%, transparent 20%),
      radial-gradient(circle at 90% 80%, rgba(16, 185, 129, 0.1) 0%, transparent 20%),
      radial-gradient(circle at 50% 50%, rgba(245, 158, 11, 0.05) 0%, transparent 50%);
    z-index: -1;
  }

@keyframes gradientShift {
  0% {background-position: 0% 50%;}
  50% {background-position: 100% 50%;}
  100% {background-position: 0% 50%;}
}

/* ==== Smaller Action Buttons ==== */
.action-buttons {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  margin-top: 20px;
}
.action-button {
  padding: 10px;
  border-radius: 12px;
  font-size: 0.9rem;
  font-weight: 600;
}

</style>
</head>
<body>
  <div class="app">
    <div class="logo-container">
      <img src="https://i.ibb.co/r28SP1bN/20250802-225108.png" alt="Laam Logo">
      <h1>Laam wallet</h1>
    </div>

    <!-- AUTH SECTION -->
    <div id="authSection">
      <div class="import-card">
        <div id="unlockView" class="hidden">
          <h3 style="margin:0 0 20px 0; color:#1976d2; text-align:center; font-size:1.5rem;">Unlock Wallet</h3>
          <div class="form-group">
            <label class="form-label" for="walletPassword">Password</label>
            <input class="form-input" id="walletPassword" type="password" placeholder="Enter your password" />
          </div>
          <button class="import-button" id="unlockBtn">Unlock</button>
          
          <!-- Real Fingerprint Unlock Section -->
          <div class="fingerprint-section" id="fingerprintSection" style="display: none;">
            <div class="divider">
              <span class="divider-text">or unlock with</span>
            </div>
            
            <button class="fingerprint-btn" id="fingerprintUnlockBtn">
              <span class="fingerprint-icon">üñêÔ∏è</span>
              Fingerprint Unlock
            </button>
            
            <div id="fingerprintStatus" class="fingerprint-status disabled">
              Fingerprint unlock not set up
            </div>
            
            <button class="setup-fingerprint-btn" id="setupFingerprintBtn">
              Set Up Fingerprint Unlock
            </button>
            
          
          <div class="divider">
            <span class="divider-text">or</span>
          </div>
          <div class="generate-link">
            <a href="#" id="resetWalletLink" style="color:#1976d2; text-decoration:none;">Reset and Import New Key</a>
          </div>
        </div>

        <div id="initialView">
          <div class="form-group">
            <label class="form-label" for="secretKeyInput">Secret Key (S...)</label>
            <input class="form-input" id="secretKeyInput" type="password" placeholder="SXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"/>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="savePasswordInput">Create Password to Save</label>
            <input class="form-input" id="savePasswordInput" type="password" placeholder="Min 8 chars"/>
          </div>
          
          <button class="import-button" id="importAndSaveBtn">Import wallet and Save</button>
          
          <div class="divider">
            <span class="divider-text">or</span>
          </div>
          
          <div class="generate-link">
            <button class="generate-button" id="generateAccountBtn">Create new wallet</button>
            <p class="note-text">(Remember: You must deposit at least 4 XLM into your wallet for it to be activated.)</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Real Fingerprint Scanner -->
    <div id="fingerprintScanner" class="fingerprint-scanner">
      <div class="scanner-container">
        <div class="scanner-animation" id="scannerAnimation">
          <!-- Fingerprint icon will be inserted here -->
        </div>
        <div class="scanner-text" id="scannerText">Ready for Fingerprint</div>
        <div class="scanner-subtext" id="scannerSubtext">Place your finger on the sensor</div>
        <button class="cancel-scan" id="cancelScan">Cancel</button>
       

    <!-- Key Display Modal -->
    <div id="keyModal" class="key-modal">
      <div class="key-modal-content">
        <div class="key-modal-header">
          <h3 class="key-modal-title">New Wallet Account Generated</h3>
          <button class="key-modal-close" onclick="closeKeyModal()">&times;</button>
        </div>
        
        <div class="key-display-group">
          <label class="key-display-label">Secret Key (S...)</label>
          <div class="key-display-container">
            <textarea class="key-display-input" id="generatedSecretKey" readonly rows="3"></textarea>
            <button class="copy-btn" onclick="copyToClipboard('generatedSecretKey', this)">Copy</button>
          </div>
        </div>

        <div class="key-display-group">
          <label class="key-display-label">Public Key (G...)</label>
          <div class="key-display-container">
            <textarea class="key-display-input" id="generatedPublicKey" readonly rows="2"></textarea>
            <button class="copy-btn" onclick="copyToClipboard('generatedPublicKey', this)">Copy</button>
          </div>
        </div>

        <div class="warning-text">
          <strong>‚ö†Ô∏èIMPORTANT</strong> Save your Secret Key in a secure place! You will need it to access your wallet. If you lose it, you will not be able to recover your account. Also, copy your public key and fund it with at least 4 XLM to activate your wallet.
        </div>

        <button class="use-account-btn" onclick="useGeneratedAccount()">Use This Account</button>
      </div>
    </div>

    <!-- LOGGED IN VIEW -->
    <div id="loggedInView" class="hidden">
      <!-- Wallet Container with New Design -->
      <div class="wallet-container">
        <!-- Total Assets -->
<div class="total-assets">
   Total Assets: $<span id="totalAssets">0.00</span>
</div>

<!-- Wizard Overlay -->
<div id="wizardOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:999;"></div>

<!-- Send Wizard Modal -->
<div id="sendWizard" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:black; padding:20px; border-radius:12px; z-index:1000; width:320px; max-width:90%; color:white;">
  <h3>Send Asset</h3>

  <!-- Error Box -->
  <div id="wizardError" style="display:none; color:#ff3b30; font-weight:600; margin-bottom:10px; text-align:center;">
    Please fill in all required fields
  </div>

  <!-- Step 1: Choose Asset -->
  <div id="step1" class="wizard-step">
    <label for="sendAsset">Asset <span style="color:red">*</span></label>
    <select id="sendAsset" style="width:100%; margin-bottom:10px;">
      <option value="">--Choose--</option>
      <option value="XLM">XLM</option>
      <option value="LAAM">LAAM</option>
      <option value="USDC">USDC</option>
    </select>
    <div class="btn-group" style="display:flex; gap:10px; margin-top:10px;">
      <button onclick="nextStep(2)" style="flex:1;">Next</button>
    </div>
  </div>

  <!-- Step 2: Enter Amount -->
  <div id="step2" class="wizard-step" style="display:none;">
    <label for="sendAmount">Amount <span style="color:red">*</span></label>
    <input type="number" id="sendAmount" placeholder="0.0" style="width:100%; margin-bottom:10px;">
    <div class="btn-group" style="display:flex; gap:10px; margin-top:10px;">
      <button onclick="nextStep(3)" style="flex:1;">Next</button>
    </div>
  </div>

  <!-- Step 3: Enter Address or Scan -->
  <div id="step3" class="wizard-step" style="display:none;">
    <label for="sendDest">Destination Address <span style="color:red">*</span></label>
    <input type="text" id="sendDest" placeholder="Enter Stellar address" style="width:100%; margin-bottom:10px;">
    <button type="button" id="scanQRBtn" style="width:100%; margin-bottom:10px;">Scan QR</button>
    <div id="qr-reader" style="width:100%; display:none; margin-bottom:10px;"></div>
    <div class="btn-group" style="display:flex; gap:10px; margin-top:10px;">
      <button onclick="nextStep(4)" style="flex:1;">Next</button>
    </div>
  </div>

  <!-- Step 4: Memo (Optional) -->
  <div id="step4" class="wizard-step" style="display:none;">
    <label for="sendMemo">Memo (Optional)</label>
    <input type="text" id="sendMemo" placeholder="Memo text" style="width:100%; margin-bottom:10px;">
    <div class="btn-group" style="display:flex; gap:10px; margin-top:10px;">
      <button onclick="nextStep(5)" style="flex:1;">Next</button>
    </div>
  </div>

  <!-- Step 5: Confirm -->
  <div id="step5" class="wizard-step" style="display:none;">
    <h4>Confirm Transaction</h4>
    <p>Asset: <span id="confirmAsset"></span></p>
    <p>Amount: <span id="confirmAmount"></span></p>
    <p>Destination: <span id="confirmDest" style="display:inline-block; word-break:break-all; max-width:100%;"></span></p>
    <p>Memo: <span id="confirmMemo"></span></p>
    <div class="btn-group" style="display:flex; gap:10px; margin-top:20px;">
      <button id="confirmSendBtn" onclick="sendTransaction()" style="flex:1;">Send Now</button>
    </div>
  </div>
<!-- Step 6: Enhanced Receipt -->
<div id="step6" class="wizard-step" style="display:none; text-align:left;">
  <div style="background:white; padding:20px; border-radius:16px; color:black; box-shadow:0 6px 15px rgba(0,0,0,0.15); font-family:sans-serif;">
    <h4 style="text-align:center; margin-bottom:15px; color:#333;">Transaction Sent!</h4>

    <p style="margin:8px 0; word-break:break-word;">
      <strong>Destination:</strong> <span id="receiptDest"></span>
      <button onclick="copyToClipboard('receiptDest')" title="Copy" style="margin-left:5px; padding:4px 6px; font-size:12px; border:none; border-radius:6px; background:#f0f0f0; color:#333; cursor:pointer;">
        üìã
      </button>
    </p>

    <p style="margin:8px 0; word-break:break-all;">
      <strong>Txid / Hash:</strong> 
      <a id="receiptHash" href="#" target="_blank" style="color:#1a73e8; text-decoration:underline;"></a>
      <button onclick="copyToClipboard('receiptHash')" title="Copy" style="margin-left:5px; padding:4px 6px; font-size:12px; border:none; border-radius:6px; background:#f0f0f0; color:#333; cursor:pointer;">
        üìã
      </button>
    </p>

    <p style="margin:8px 0;"><strong>Amount:</strong> <span id="receiptAmount"></span></p>
    <p style="margin:8px 0;"><strong>Date:</strong> <span id="receiptDate"></span></p>

    <div style="text-align:center; margin-top:20px;">
      <button onclick="closeWizard()" style="padding:10px 20px; font-size:14px; border:none; border-radius:12px; background:#1a73e8; color:white; font-weight:600; cursor:pointer;">Close</button>
    </div>
  </div>
</div>
 </div>
</div>

    <!-- Action Buttons -->
        <div class="action-buttons">
          <div class="action-button send" id="btnSend">
            <div class="action-icon">‚û§</div>
            <div class="action-text">Send</div>
          </div>
          <div class="action-button receive" id="btnReceive">
            <div class="action-icon">üì•</div>
            <div class="action-text">Receive</div>
          </div>
          <div class="action-button trustline" id="addTrustlineBtn">
            <div class="action-icon">+</div>
            <div class="action-text">Add Trustline</div>
          </div>
          <div class="action-button lock" id="logoutBtn">
            <div class="action-icon">üîí</div>
            <div class="action-text">Lock</div>
          </div>
        </div>
        
        <!-- Assets Grid -->
        <div class="assets-grid">
          <!-- XLM -->
          <div class="asset-item" data-token="XLM">
              <div class="asset-left">
                  <div class="asset-icon">
                      <img src="https://res.coinpaper.com/coinpaper/stellar_xlm_logo_07021d63c0.png" alt="XLM">
                  </div>
                  <div class="asset-details">
                      <div class="asset-name">XLM</div>
                      <div class="asset-price">
                          <small class="per">$<span id="xlmPrice">0.409</span></small>
                          <span id="xlmChange" class="price-change positive">+2.5%</span>
                      </div>
                  </div>
              </div>
              <div class="asset-right">
                  <div class="asset-balance"><span id="xlmBal">0</span> XLM</div>
                  <div class="asset-balance-sub">‚âà $<span id="xlmBalUsd">0</span></div>
              </div>
          </div>

          <!-- LAAM -->
          <div class="asset-item" data-token="LAAM">
              <div class="asset-left">
                  <div class="asset-icon">
                      <img src="https://i.ibb.co/r28SP1bN/20250802-225108.png" alt="LAAM">
                  </div>
                  <div class="asset-details">
                      <div class="asset-name">Laam</div>
                      <div class="asset-price">
                          <small class="per">$<span id="laamPrice">0.056</span></small>
                          <span id="laamChange" class="price-change negative">-1.2%</span>
                      </div>
                  </div>
              </div>
              <div class="asset-right">
                  <div class="asset-balance"><span id="laamBal">0</span> Laam</div>
                  <div class="asset-balance-sub">‚âà $<span id="laamBalUsd">0</span></div>
              </div>
          </div>

          <!-- USDC -->
          <div class="asset-item" data-token="USDC">
              <div class="asset-left">
                  <div class="asset-icon">
                      <img src="https://i.ibb.co/r2qNFs22/images-2.png" alt="USDC">
                  </div>
                  <div class="asset-details">
                      <div class="asset-name">USDC</div>
                      <div class="asset-price">
                          <small class="per">$<span id="usdcPrice">1.00</span></small>
                          <span id="usdcChange" class="price-change">0.00%</span>
                      </div>
                  </div>
              </div>
              <div class="asset-right">
                  <div class="asset-balance"><span id="usdcBal">0</span> USDC</div>
                  <div class="asset-balance-sub">‚âà $<span id="usdcBalUsd">0</span></div>
              </div>
          </div>
        </div>
      
      <!-- Token Modal -->
      <div class="token-modal" id="tokenModal">
        <div class="token-modal-content">
          <div class="token-modal-header">
            <h2 id="modalTokenName">XLM</h2>
            <p>Select an action</p>
          </div>
          <div class="token-modal-body">
            <div class="token-info">
              <div class="token-icon">
                <img id="modalTokenIcon" src="https://res.coinpaper.com/coinpaper/stellar_xlm_logo_07021d63c0.png" alt="Token">
              </div>
              <div class="token-details">
                <h3 id="modalTokenBalance">0 XLM</h3>
                <p id="modalTokenValue">$0.00</p>
              </div>
            </div>
            <div class="token-modal-actions">
              <button class="token-modal-btn send" onclick="openSendWizardForToken()">
                <i>‚û§</i>
                <span>Send</span>
              </button>
              <button class="token-modal-btn receive" onclick="openReceiveForToken()">
                <i>üì•</i>
                <span>Receive</span>
              </button>
            </div>
          </div>
        </div>
        <div class="close-token-modal" onclick="closeTokenModal()">
          <i>‚úï</i>
        </div>
      </div>
                        
      <!-- Enhanced Trade Section -->
      <div class="card trade-card">
     <div class="trade-header">
<span class="icon" id="refreshOB" onclick="fetchOrderbook()">‚Üª</span>
  <h3>Trade</h3>
  <span class="icon" id="myOrdersBtn" onclick="openMyOrdersModal()">offers</span>
</div>
        <div class="trade-asset-selector">
          <div class="asset-box">
            <img src="https://i.ibb.co/r28SP1bN/20250802-225108.png" alt="Laam">
            <div>
              <div class="asset-name">Laam</div>
              <div class="asset-issuer">laam.online</div>
            </div>
          </div>
          <span class="swap-icon" id="swapAssets" onclick="swapTradeAssets()">‚áÑ</span>
          <div class="asset-box">
            <img src="https://res.coinpaper.com/coinpaper/stellar_xlm_logo_07021d63c0.png" alt="XLM">
            <div>
              <div class="asset-name">XLM</div>
              <div class="asset-issuer">stellar.org</div>
            </div>
          </div>
        </div>
        
        <!-- Enhanced Trade Tabs -->
        <div class="trade-tabs">
          <div class="tab" id="overviewTab">Overview</div>
          <div class="tab active" id="orderbookTab">Orderbook</div>
          <div class="tab" id="lastTradesTab">Last Trades</div>
        </div>
        
        <!-- Overview Tab Content -->
        <div id="overviewContent" class="tab-content">
          <div class="overview-content">
            <div class="price-display">
              <span id="overviewLaamPriceXLM">0.000000</span>$
            </div>
            <div class="price-change" id="priceChange">Loading price change...</div>
            
            <div class="chart-timeframes">
              <button class="timeframe-btn active" data-timeframe="1D">1D</button>
              <button class="timeframe-btn" data-timeframe="1W">1W</button>
              <button class="timeframe-btn" data-timeframe="1M">1M</button>
              <button class="timeframe-btn" data-timeframe="ALL">ALL</button>
            </div>
            
            <!-- Chart container for Chart.js -->
            <div class="chart-container">
              <canvas id="priceChart"></canvas>
            </div>
            
            <div class="market-stats">
              <div class="stat-item">
                <div class="stat-label">24h Volume</div>
                <div class="stat-value" id="volume24h">0 Laam</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">24h High</div>
                <div class="stat-value" id="high24h">0.000000 XLM</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">24h Low</div>
                <div class="stat-value" id="low24h">0.000000 XLM</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">Market Cap</div>
                <div class="stat-value" id="marketCap">0 XLM</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Orderbook Tab Content -->
        <div id="orderbookContent" class="tab-content active">
          <div class="orderbook-content">
            <table class="orderbook-table">
              <thead><tr><th>Amount (Laam)</th><th>Price (XLM)</th><th>Total (XLM)</th></tr></thead>
              <tbody id="asksBody">
                <tr><td colspan="3" style="text-align:center; padding:20px;"><div class="loading-spinner"></div> Loading...</td></tr>
              </tbody>
            </table>
            <div class="spread" id="spreadValue">Loading spread...</div>
            <table class="orderbook-table">
              <tbody id="bidsBody">
                <tr><td colspan="3" style="text-align:center; padding:20px;"><div class="loading-spinner"></div> Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Last Trades Tab Content -->
        <div id="lastTradesContent" class="tab-content">
          <div class="trades-content">
            <table class="trades-table">
              <thead><tr><th>Time</th><th>Type</th><th>Price (XLM)</th><th>Amount (Laam)</th></tr></thead>
              <tbody id="tradesBody">
                <tr><td colspan="4" style="text-align:center; padding:20px;"><div class="loading-spinner"></div> Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <div class="trade-actions">
          <button class="btn-buy" id="btnBuy">Buy</button>
          <button class="btn-sell" id="btnSell">Sell</button>
        </div>

    <!-- Trade Modal -->
    <div id="tradeModal" class="trade-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" id="modalTitle">Buy Laam</h3>
          <button class="modal-close" onclick="closeTradeModal()">&times;</button>
        </div>
        <div class="panel">
          <div class="titleRow">
            <div class="title" id="panelTitle">Buy Laam</div>
            <div class="avail">Available: <span id="availBalance">0 XLM</span></div>
          </div>

          <div class="field">
            <div class="inputWrap">
              <input id="modalPrice" type="number" step="0.0000001" placeholder="0.135000" />
              <div class="unit">XLM</div>
            </div>
            <div class="hint">Price (XLM per Laam)</div>
          </div>

          <div class="field">
            <div class="inputWrap">
              <input id="modalAmount" type="number" step="0.0000001" placeholder="Amount" />
              <div class="unit">Laam</div>
            </div>
            <div class="rowBtns">
              <button data-fill="25">25%</button>
              <button data-fill="50">50%</button>
              <button data-fill="75">75%</button>
              <button data-fill="100">100%</button>
            </div>
          </div>

          <div class="totalBox">
            <div class="inputWrap">
              <input id="modalTotal" type="number" step="0.0000001" placeholder="Total" readonly />
              <div class="unit">XLM</div>
            </div>
            <div class="hint">Total cost</div>
          </div>

          <button class="cta buy" id="modalBuyBtn">Buy Laam</button>
        </div>
      </div>
    </div>

    <!-- My Orders Modal -->
    <div id="myOrdersModal" class="my-orders-modal">
      <div class="my-orders-modal-content">
        <div class="my-orders-modal-header">
          <h3 class="my-orders-modal-title">My Orders</h3>
          <button class="my-orders-modal-close" onclick="closeMyOrdersModal()">&times;</button>
        </div>
        
        <div id="ordersList" class="orders-list">
          <div class="loading-spinner"></div>
        </div>
        
        <div class="order-actions">
          <button class="order-action-btn edit-order-btn" onclick="promptEditOffer()">Edit Order</button>
          <button class="order-action-btn cancel-order-btn" onclick="confirmCancelOffer()">Cancel Order</button>
        </div>
      </div>
    </div>

    <!-- Edit Order Modal -->
    <div id="editOrderModal" class="trade-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Edit Order</h3>
          <button class="modal-close" onclick="closeEditModal()">&times;</button>
        </div>
        <div class="panel">
          <div class="field">
            <label>Amount (Laam)</label>
            <input id="editAmount" type="number" step="0.0001">
          </div>
          <div class="field">
            <label>Price (XLM per Laam)</label>
            <input id="editPrice" type="number" step="0.0000001">
          </div>
          <button class="cta" id="confirmEditBtn">Update Order</button>
        </div>
      </div>
    </div>
    <div id="errorAlert" class="custom-alert" style="background:#dc3545;">Error here</div>
    <div id="successAlert" class="custom-alert">Transaction sent successfully</div>
  </div>

  <script>
    // Laam token configuration
    const LAAM_TOKEN = {
      code: "Laam",
      issuer: "GAL4ECDAXNBMJYFCWIJ32HKVIRLCNEXY664CAZYI3EINQWPLXTMEPR64",
      name: "Laam",
      description: "Laam is a limited supply token on Stellar with a maximum of 1,335,577 tokens, issued only once to preserve value.",
      image: "https://i.ibb.co/r28SP1bN/20250802-225108.png",
      maxSupply: 1335577,
      currentPrice: 0.06
    };

    // USDC token configuration
    const USDC_TOKEN = {
      code: "USDC",
      issuer: "GA5ZSEJYB37JRC5AVCIA5MOP4RHTM335X2KGX3IHOJAPP5RE34K4KZVN"
    };
    
    // Global variables
    let currentKeypair = null;
    let server = null;
    let USDC_ASSET = null;
    let LAAM_ASSET = null;
    let xlmPriceUSD = 0.42;
    let currentTradeMode = 'buy';
    let generatedKeypair = null;
    let currentTab = 'orderbook';
    let orderbookData = { bids: [], asks: [] };
    let tradesData = [];
    let currentOfferId = null;
    let currentOfferType = null;
    let priceChart = null; // Chart.js instance

    // Initialize Stellar SDK
    function initializeStellar() {
      try {
        if (typeof StellarSdk !== 'undefined') {
          server = new StellarSdk.Server('https://horizon.stellar.org');
          console.log('Stellar SDK initialized successfully');
        } else {
          console.error('Stellar SDK not loaded');
          showError('Stellar SDK failed to load. Please refresh the page.');
        }
      } catch (error) {
        console.error('Error initializing Stellar SDK:', error);
        showError('Failed to initialize Stellar SDK: ' + error.message);
      }
    }
    
    function initializeAssets() {
      try {
        if (typeof StellarSdk !== 'undefined') {
          LAAM_ASSET = new StellarSdk.Asset(LAAM_TOKEN.code, LAAM_TOKEN.issuer);
          USDC_ASSET = new StellarSdk.Asset(USDC_TOKEN.code, USDC_TOKEN.issuer);
          console.log('Assets initialized successfully');
        }
      } catch (error) {
        console.error('Error initializing assets:', error);
      }
    }
    
    // Utility functions
    function showError(message) {
  const alertBox = document.getElementById("errorAlert");
  alertBox.textContent = "‚ùå " + message;
  alertBox.style.display = "block";
  setTimeout(() => {
    alertBox.style.display = "none";
  }, 4000);
      }
function showSuccess(message) {
  const alertBox = document.getElementById("successAlert");
  alertBox.textContent = "‚úÖ " + message;
  alertBox.style.display = "block";
  setTimeout(() => {
    alertBox.style.display = "none";
  }, 3000);
      }
    
    function formatAmount(amount) {
      return parseFloat(amount).toFixed(7);
    }
    
    function encryptSecretKey(secretKey, password) {
      return CryptoJS.AES.encrypt(secretKey, password).toString();
    }
    
    function decryptSecretKey(encryptedKey, password) {
      try {
        const bytes = CryptoJS.AES.decrypt(encryptedKey, password);
        return bytes.toString(CryptoJS.enc.Utf8);
      } catch (e) {
        return null;
      }
    }

    // Copy to clipboard function
    async function copyToClipboard(elementId, buttonElement) {
      try {
        const element = document.getElementById(elementId);
        const text = element.value;
        
        await navigator.clipboard.writeText(text);
        
        const originalText = buttonElement.textContent;
        buttonElement.textContent = 'Copied!';
        buttonElement.classList.add('copied');
        
        setTimeout(() => {
          buttonElement.textContent = originalText;
          buttonElement.classList.remove('copied');
        }, 2000);
        
      } catch (err) {
        console.error('Failed to copy:', err);
        const element = document.getElementById(elementId);
        element.select();
        element.setSelectionRange(0, 99999);
        document.execCommand('copy');
        
        const originalText = buttonElement.textContent;
        buttonElement.textContent = 'Copied!';
        buttonElement.classList.add('copied');
        
        setTimeout(() => {
          buttonElement.textContent = originalText;
          buttonElement.classList.remove('copied');
        }, 2000);
      }
    }

    // Key modal functions
    function openKeyModal(secretKey, publicKey) {
      document.getElementById('generatedSecretKey').value = secretKey;
      document.getElementById('generatedPublicKey').value = publicKey;
      document.getElementById('keyModal').classList.add('show');
    }

    function closeKeyModal() {
      document.getElementById('keyModal').classList.remove('show');
      generatedKeypair = null;
    }

    function useGeneratedAccount() {
      if (generatedKeypair) {
        document.getElementById('secretKeyInput').value = generatedKeypair.secret();
        closeKeyModal();
        showSuccess('Account keys have been filled in the form. Please create a password to save your wallet.');
      }
    }

    // Tab switching functionality
    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      document.getElementById(tabName + 'Tab').classList.add('active');
      document.getElementById(tabName + 'Content').classList.add('active');
      
      currentTab = tabName;
      
      if (tabName === 'orderbook') {
        fetchOrderbook();
      } else if (tabName === 'lastTrades') {
        fetchTrades();
      } else if (tabName === 'overview') {
        updateOverview();
      }
    }

    // Fetch XLM price from API
    async function fetchXLMPrice() {
      try {
        const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=stellar&vs_currencies=usd');
        const data = await response.json();
        if (data.stellar && data.stellar.usd) {
          xlmPriceUSD = data.stellar.usd;
          console.log('XLM price updated:', xlmPriceUSD);
        }
      } catch (error) {
        console.error('Error fetching XLM price:', error);
        xlmPriceUSD = 0.12;
      }
    }

    // Create a beautiful price chart
    function createPriceChart() {
      const ctx = document.getElementById('priceChart').getContext('2d');
      
      // Sample price data (in a real app, this would come from an API)
      const prices = [0.12, 0.125, 0.128, 0.13, 0.132, 0.135, 0.133, 0.131, 0.129, 0.127, 0.125, 0.128, 0.13, 0.132, 0.135];
      const labels = Array.from({length: prices.length}, (_, i) => {
        const d = new Date();
        d.setHours(d.getHours() - (prices.length - i - 1));
        return d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      });
      
      // Destroy existing chart if it exists
      if (priceChart) {
        priceChart.destroy();
      }
      
      priceChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'LAAM/XLM Price',
            data: prices,
            borderColor: '#1976d2',
            backgroundColor: 'rgba(25, 118, 210, 0.1)',
            borderWidth: 2,
            pointRadius: 3,
            pointBackgroundColor: '#1976d2',
            pointBorderColor: '#fff',
            pointHoverRadius: 5,
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              mode: 'index',
              intersect: false,
              backgroundColor: 'rgba(0, 0, 0, 0.7)',
              titleFont: {
                size: 14
              },
              bodyFont: {
                size: 13
              }
            }
          },
          scales: {
            x: {
              grid: {
                display: false
              },
              ticks: {
                maxRotation: 0,
                autoSkip: true,
                maxTicksLimit: 6
              }
            },
            y: {
              grid: {
                color: 'rgba(0, 0, 0, 0.05)'
              },
              ticks: {
                callback: function(value) {
                  return value.toFixed(3) + ' XLM';
                }
              }
            }
          },
          interaction: {
            intersect: false,
            mode: 'index',
          }
        }
      });
    }

    // Update overview tab
    function updateOverview() {
      const currentPrice = 0.135000;
      const priceChange = 0.005000;
      const priceChangePercent = ((priceChange / (currentPrice - priceChange)) * 100).toFixed(2);
      
      document.getElementById('overviewLaamPriceXLM').textContent = currentPrice.toFixed(6);
      
      const priceChangeElement = document.getElementById('priceChange');
      priceChangeElement.textContent = `+${priceChange.toFixed(6)} (+${priceChangePercent}%)`;
      priceChangeElement.className = priceChange >= 0 ? 'price-change positive' : 'price-change negative';
      
      // Create or update the price chart
      createPriceChart();
    }

    // Fetch orderbook data
    async function fetchOrderbook() {
  try {
    console.log('Fetching orderbook data...');
    
    document.getElementById('asksBody').innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px;"><div class="loading-spinner"></div> Loading asks...</td></tr>';
    document.getElementById('bidsBody').innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px;"><div class="loading-spinner"></div> Loading bids...</td></tr>';
    document.getElementById('spreadValue').innerHTML = '<div class="loading-spinner"></div> Loading spread...';
    
    const orderbookUrl = `https://horizon.stellar.org/order_book?selling_asset_type=credit_alphanum4&selling_asset_code=${LAAM_TOKEN.code}&selling_asset_issuer=${LAAM_TOKEN.issuer}&buying_asset_type=native&limit=10`;
    
    const response = await fetch(orderbookUrl);
    const data = await response.json();
    
    console.log('Orderbook data received:', data);
    
    document.getElementById('asksBody').innerHTML = '';
    document.getElementById('bidsBody').innerHTML = '';
    
    // ‚úÖ HAGAaji: ASKS - Iibiyayaasha (SELL ORDERS)
    const asksBody = document.getElementById('asksBody');
    if (data.asks && data.asks.length > 0) {
      orderbookData.asks = data.asks;
      data.asks.slice(0, 5).forEach(ask => {
        const row = document.createElement('tr');
        row.className = 'ask-row';
        const amount = parseFloat(ask.amount).toFixed(2);
        const price = parseFloat(ask.price).toFixed(7); // Qiimaha iibiyayaasha
        const total = (parseFloat(ask.amount) * parseFloat(ask.price)).toFixed(7);
        
        row.innerHTML = `
          <td>${amount}</td>
          <td>${price}</td>
          <td>${total}</td>
        `;
        
        row.addEventListener('click', () => {
          if (document.getElementById('tradeModal').classList.contains('show')) {
            document.getElementById('modalPrice').value = price;
            calculateTotal();
          }
        });
        
        asksBody.appendChild(row);
      });
    }  else {
          const sampleAsks = [
            { amount: '1000.00', price: '0.1450000', total: '145.0000000' },
            { amount: '750.00', price: '0.1400000', total: '105.0000000' },
            { amount: '500.00', price: '0.1380000', total: '69.0000000' },
            { amount: '1200.00', price: '0.1360000', total: '163.2000000' },
            { amount: '800.00', price: '0.1350000', total: '108.0000000' }
          ];
          
          sampleAsks.forEach(ask => {
            const row = document.createElement('tr');
            row.className = 'ask-row';
            row.innerHTML = `
              <td>${ask.amount}</td>
              <td>${ask.price}</td>
              <td>${ask.total}</td>
            `;
            
            row.addEventListener('click', () => {
              if (document.getElementById('tradeModal').classList.contains('show')) {
                document.getElementById('modalPrice').value = ask.price;
                calculateTotal();
              }
            });
            
            asksBody.appendChild(row);
          });
        }
        const bidsBody = document.getElementById('bidsBody');
if (data.bids && data.bids.length > 0) {
  orderbookData.bids = data.bids;
  data.bids.slice(0, 5).forEach(bid => {
    // HADII BID.PRICE UU YAHY XLM per LAAM (0.1355)
    const laamAmount = parseFloat(bid.amount); // 30 LAAM
    const priceXLMperLaam = parseFloat(bid.price); // 0.1355 XLM per LAAM
    
    // Calculate total XLM
    const totalXLM = (laamAmount * priceXLMperLaam).toFixed(2); // 30 * 0.1355 = 4.065 XLM
    
    const row = document.createElement('tr');
    row.className = 'bid-row';
    row.innerHTML = `
      <td>${laamAmount.toFixed(2)}</td> <!-- 30.00 LAAM -->
      <td>${priceXLMperLaam.toFixed(4)}</td> <!-- 0.1355 XLM -->
      <td>${totalXLM}</td> <!-- 4.0650000 XLM -->
    `;

    row.addEventListener('click', () => {
      if (document.getElementById('tradeModal').classList.contains('show')) {
        document.getElementById('modalPrice').value = priceXLMperLaam;
        calculateTotal();
      }
    });

    bidsBody.appendChild(row);
  });
}else {
  const sampleBids = [
    { amount: '900.00', price: '0.1300000', total: '117.0000000' },
    { amount: '1100.00', price: '0.1280000', total: '140.8000000' },
    { amount: '600.00', price: '0.1250000', total: '75.0000000' },
    { amount: '1500.00', price: '0.1220000', total: '183.0000000' },
    { amount: '700.00', price: '0.1200000', total: '84.0000000' }
  ];
  
  sampleBids.forEach(bid => {
    const row = document.createElement('tr');
    row.className = 'bid-row';
    row.innerHTML = `
      <td>${bid.amount}</td>
      <td>${bid.price}</td>
      <td>${bid.total}</td>
    `;
    
    row.addEventListener('click', () => {
      if (document.getElementById('tradeModal').classList.contains('show')) {
        document.getElementById('modalPrice').value = bid.price;
        calculateTotal();
      }
    });
    
    bidsBody.appendChild(row);
  });
}
        
        let spread = 'No data';
    if (data.asks && data.asks.length > 0 && data.bids && data.bids.length > 0) {
      const bestAsk = parseFloat(data.asks[0].price); // Ugu yar - iibiyayaasha
      const bestBid = parseFloat(data.bids[0].price); // Ugu weyn - cassanayaasha
      const spreadValue = bestAsk - bestBid;
      const spreadPercent = ((spreadValue / bestBid) * 100).toFixed(2);
      spread = `Spread: ${spreadValue.toFixed(7)} XLM (${spreadPercent}%)`;
    }
    
    document.getElementById('spreadValue').textContent = spread;
    
    console.log('Orderbook updated successfully');
    
  } catch (error) {
    console.error('Error fetching orderbook:', error);
        
        document.getElementById('asksBody').innerHTML = `
          <tr class="ask-row"><td>1000.00</td><td>0.1450000</td><td>145.0000000</td></tr>
          <tr class="ask-row"><td>750.00</td><td>0.1400000</td><td>105.0000000</td></tr>
          <tr class="ask-row"><td>500.00</td><td>0.1380000</td><td>69.0000000</td></tr>
          <tr class="ask-row"><td>1200.00</td><td>0.1360000</td><td>163.2000000</td></tr>
          <tr class="ask-row"><td>800.00</td><td>0.1350000</td><td>108.0000000</td></tr>
        `;
        
        document.getElementById('bidsBody').innerHTML = `
          <tr class="bid-row"><td>900.00</td><td>0.1300000</td><td>117.0000000</td></tr>
          <tr class="bid-row"><td>1100.00</td><td>0.1280000</td><td>140.8000000</td></tr>
          <tr class="bid-row"><td>600.00</td><td>0.1250000</td><td>75.0000000</td></tr>
          <tr class="bid-row"><td>1500.00</td><td>0.1220000</td><td>183.0000000</td></tr>
          <tr class="bid-row"><td>700.00</td><td>0.1200000</td><td>84.0000000</td></tr>
        `;
        
        document.getElementById('spreadValue').textContent = 'Spread: 0.0150000 XLM (11.54%)';
        
        document.querySelectorAll('.ask-row, .bid-row').forEach(row => {
          row.addEventListener('click', () => {
            const price = row.children[1].textContent;
            if (document.getElementById('tradeModal').classList.contains('show')) {
              document.getElementById('modalPrice').value = price;
              calculateTotal();
            }
          });
        });
      }
    }

    // Fetch trades data
    async function fetchTrades() {
      try {
        console.log('Fetching trades data...');
        
        document.getElementById('tradesBody').innerHTML = '<tr><td colspan="4" style="text-align:center; padding:20px;"><div class="loading-spinner"></div> Loading trades...</td></tr>';
        
        const tradesUrl = `https://horizon.stellar.org/trades?base_asset_type=credit_alphanum4&base_asset_code=${LAAM_TOKEN.code}&base_asset_issuer=${LAAM_TOKEN.issuer}&counter_asset_type=native&limit=20&order=desc`;
        
        const response = await fetch(tradesUrl);
        const data = await response.json();
        
        console.log('Trades data received:', data);
        
        const tradesBody = document.getElementById('tradesBody');
        tradesBody.innerHTML = '';
        
        if (data._embedded && data._embedded.records && data._embedded.records.length > 0) {
          tradesData = data._embedded.records;
          data._embedded.records.slice(0, 10).forEach(trade => {
            const row = document.createElement('tr');
            const time = new Date(trade.ledger_close_time).toLocaleTimeString();
            const type = trade.base_is_seller ? 'SELL' : 'BUY';
            const price = parseFloat(trade.price.n / trade.price.d).toFixed(7);
            const amount = parseFloat(trade.base_amount).toFixed(2);
            
            row.innerHTML = `
              <td class="trade-time">${time}</td>
              <td class="${type.toLowerCase() === 'buy' ? 'trade-buy' : 'trade-sell'}">${type}</td>
              <td>${price}</td>
              <td>${amount}</td>
            `;
            tradesBody.appendChild(row);
          });
        } else {
          const sampleTrades = [
            { time: '14:32:15', type: 'BUY', price: '0.1350000', amount: '250.00' },
            { time: '14:28:42', type: 'SELL', price: '0.1340000', amount: '180.50' },
            { time: '14:25:18', type: 'BUY', price: '0.1345000', amount: '320.75' },
            { time: '14:22:03', type: 'BUY', price: '0.1338000', amount: '150.25' },
            { time: '14:18:47', type: 'SELL', price: '0.1335000', amount: '400.00' },
            { time: '14:15:22', type: 'BUY', price: '0.1342000', amount: '275.50' },
            { time: '14:12:08', type: 'SELL', price: '0.1330000', amount: '190.75' },
            { time: '14:08:35', type: 'BUY', price: '0.1348000', amount: '225.00' }
          ];
          
          sampleTrades.forEach(trade => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td class="trade-time">${trade.time}</td>
              <td class="${trade.type.toLowerCase() === 'buy' ? 'trade-buy' : 'trade-sell'}">${trade.type}</td>
              <td>${trade.price}</td>
              <td>${trade.amount}</td>
            `;
            tradesBody.appendChild(row);
          });
        }
        
        console.log('Trades updated successfully');
        
      } catch (error) {
        console.error('Error fetching trades:', error);
        
        const sampleTrades = [
          { time: '14:32:15', type: 'BUY', price: '0.1350000', amount: '250.00' },
          { time: '14:28:42', type: 'SELL', price: '0.1340000', amount: '180.50' },
          { time: '14:25:18', type: 'BUY', price: '0.1345000', amount: '320.75' },
          { time: '14:22:03', type: 'BUY', price: '0.1338000', amount: '150.25' },
          { time: '14:18:47', type: 'SELL', price: '0.1335000', amount: '400.00' }
        ];
        
        const tradesBody = document.getElementById('tradesBody');
        tradesBody.innerHTML = '';
        
        sampleTrades.forEach(trade => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="trade-time">${trade.time}</td>
            <td class="${trade.type.toLowerCase() === 'buy' ? 'trade-buy' : 'trade-sell'}">${trade.type}</td>
            <td>${trade.price}</td>
            <td>${trade.amount}</td>
          `;
          tradesBody.appendChild(row);
        });
      }
    }

  // Update balance display function
async function updateBalanceDisplay() {
  if (!currentKeypair || !server) {
    console.log('No keypair or server available');
    return;
  }

  try {
    console.log('Loading account data...');
    const account = await server.loadAccount(currentKeypair.publicKey());

    let xlmBalance = 0;
    let laamBalance = 0;
    let usdcBalance = 0;

    account.balances.forEach(balance => {
      if (balance.asset_type === 'native') {
        xlmBalance = parseFloat(balance.balance);
      } else if (
        balance.asset_code === LAAM_TOKEN.code &&
        balance.asset_issuer === LAAM_TOKEN.issuer
      ) {
        laamBalance = parseFloat(balance.balance);
      } else if (
        balance.asset_code === USDC_TOKEN.code &&
        balance.asset_issuer === USDC_TOKEN.issuer
      ) {
        usdcBalance = parseFloat(balance.balance);
      }
    });

    // ‚úÖ XLM price + balance
    document.getElementById('xlmBal').textContent = xlmBalance.toFixed(2);
    document.getElementById('xlmBalUsd').textContent = (xlmBalance * xlmPriceUSD).toFixed(2);
    document.getElementById('xlmPrice').textContent = xlmPriceUSD.toFixed(3);

    // Sample % change (XLM)
    let xlmChange = 2.06;
    const xlmChangeEl = document.getElementById('xlmChange');
    xlmChangeEl.textContent = (xlmChange >= 0 ? '+' : '') + xlmChange.toFixed(2) + '%';
    xlmChangeEl.className = 'price-change ' + (xlmChange >= 0 ? 'positive' : 'negative');

    // ‚úÖ Laam part
    const bestSellOfferXLM = await getBestSellOfferPrice();
    const laamPriceUSD = bestSellOfferXLM * xlmPriceUSD;

    LAAM_TOKEN.currentPrice = laamPriceUSD;

    document.getElementById('laamBal').textContent = laamBalance.toFixed(2);
    document.getElementById('laamBalUsd').textContent = (laamBalance * laamPriceUSD).toFixed(2);
    document.getElementById('laamPrice').textContent = laamPriceUSD.toFixed(6);

    // Sample % change (Laam)
    let laamChange = -12.67;
    const laamChangeEl = document.getElementById('laamChange');
    laamChangeEl.textContent = (laamChange >= 0 ? '+' : '') + laamChange.toFixed(2) + '%';
    laamChangeEl.className = 'price-change ' + (laamChange >= 0 ? 'positive' : 'negative');

    // ‚úÖ USDC part
    document.getElementById('usdcBal').textContent = usdcBalance.toFixed(2);
    document.getElementById('usdcBalUsd').textContent = usdcBalance.toFixed(2);
    document.getElementById('usdcPrice').textContent = "1.00";

    const usdcChangeEl = document.getElementById('usdcChange');
    usdcChangeEl.textContent = "0.00%";
    usdcChangeEl.className = 'price-change';

    updateTotalAssets();

    console.log('Balance display updated successfully');

  } catch (error) {
    console.error('Error updating balance display:', error);
    showError('Failed to load account balance: ' + error.message);
  }
}

// Helper: get best sell offer price (Laam/XLM)
async function getBestSellOfferPrice() {
  try {
    const orderbookUrl = `https://horizon.stellar.org/order_book?selling_asset_type=credit_alphanum4&selling_asset_code=${LAAM_TOKEN.code}&selling_asset_issuer=${LAAM_TOKEN.issuer}&buying_asset_type=native&limit=1`;
    const response = await fetch(orderbookUrl);
    const data = await response.json();

    if (data.asks && data.asks.length > 0) {
      return parseFloat(data.asks[0].price); // best sell offer
    }
  } catch (e) {
    console.error("Failed to fetch best sell offer:", e);
  }
  return LAAM_TOKEN.currentPrice; // fallback
}

// Update total assets value
function updateTotalAssets() {
  const xlmUsd = parseFloat(document.getElementById('xlmBalUsd').textContent) || 0;
  const laamUsd = parseFloat(document.getElementById('laamBalUsd').textContent) || 0;
  const usdcUsd = parseFloat(document.getElementById('usdcBalUsd').textContent) || 0;

  const totalAssets = (xlmUsd + laamUsd + usdcUsd).toFixed(2);
  document.getElementById('totalAssets').textContent = totalAssets;
}
    // Load wallet function
    async function loadWallet() {
      if (!currentKeypair) {
        console.error('No keypair available');
        return;
      }

      try {
        console.log('Loading wallet for:', currentKeypair.publicKey());
        
        await fetchXLMPrice();
        await updateBalanceDisplay();
        
        if (currentTab === 'orderbook') {
          await fetchOrderbook();
        } else if (currentTab === 'lastTrades') {
          await fetchTrades();
        } else if (currentTab === 'overview') {
          updateOverview();
        }
        
        console.log('Wallet loaded successfully');
        
      } catch (error) {
        console.error('Error loading wallet:', error);
        
        // Only show error if wallet view is visible
        if (!document.getElementById('loggedInView').classList.contains('hidden')) {
          showError('Failed to load wallet: ' + error.message);
        }
      }
    }

    // Check if wallet exists in localStorage
    function checkSavedWallet() {
  const encryptedKey = localStorage.getItem('laam_wallet_key');
  const fallbackKey = localStorage.getItem('laam_wallet_biometric_fallback');
  
  if (encryptedKey) {
    document.getElementById('initialView').classList.add('hidden');
    document.getElementById('unlockView').classList.remove('hidden');
    
    // Update fingerprint UI based on fallback availability
    if (fallbackKey) {
      document.getElementById('fingerprintStatus').textContent = 'Fingerprint unlock ready';
      document.getElementById('fingerprintStatus').className = 'fingerprint-status enabled';
      document.getElementById('fingerprintUnlockBtn').disabled = false;
    }
  }
}

    // Trade modal functions
    function openTradeModal(mode) {
      currentTradeMode = mode;
      const modal = document.getElementById('tradeModal');
      const title = document.getElementById('modalTitle');
      const panelTitle = document.getElementById('panelTitle');
      const availBalance = document.getElementById('availBalance');
      const modalBuyBtn = document.getElementById('modalBuyBtn');
      
      if (mode === 'buy') {
        title.textContent = 'Buy Laam';
        panelTitle.textContent = 'Buy Laam';
        modalBuyBtn.textContent = 'Buy Laam';
        modalBuyBtn.className = 'cta buy';
        availBalance.textContent = document.getElementById('xlmBal').textContent + ' XLM';
      } else {
        title.textContent = 'Sell Laam';
        panelTitle.textContent = 'Sell Laam';
        modalBuyBtn.textContent = 'Sell Laam';
        modalBuyBtn.className = 'cta sell';
        availBalance.textContent = document.getElementById('laamBal').textContent + ' Laam';
      }
      
      document.getElementById('modalPrice').value = '';
      document.getElementById('modalAmount').value = '';
      document.getElementById('modalTotal').value = '';
      
      modal.classList.add('show');
    }

    function closeTradeModal() {
      document.getElementById('tradeModal').classList.remove('show');
    }

    function calculateTotal() {
      const price = parseFloat(document.getElementById('modalPrice').value) || 0;
      const amount = parseFloat(document.getElementById('modalAmount').value) || 0;
      const total = price * amount;
      
      document.getElementById('modalTotal').value = total.toFixed(7);
    }

    function fillPercentage(percentage) {
      const availBalance = document.getElementById('availBalance').textContent;
      const balanceValue = parseFloat(availBalance.split(' ')[0]);
      const price = parseFloat(document.getElementById('modalPrice').value) || 0;
      
      if (currentTradeMode === 'buy') {
        const maxAmount = balanceValue / price;
        const fillAmount = maxAmount * (percentage / 100);
        document.getElementById('modalAmount').value = fillAmount.toFixed(7);
      } else {
        const fillAmount = balanceValue * (percentage / 100);
        document.getElementById('modalAmount').value = fillAmount.toFixed(7);
      }
      
      calculateTotal();
    }

    async function placeOrder() {
      const price = parseFloat(document.getElementById('modalPrice').value);
      const amount = parseFloat(document.getElementById('modalAmount').value);
      
      if (!price || !amount) {
        showError('Please enter both price and amount');
        return;
      }
      
      try {
        const account = await server.loadAccount(currentKeypair.publicKey());
        
        let operation;
        if (currentTradeMode === 'buy') {
          // Buy Laam with XLM
          operation = StellarSdk.Operation.manageBuyOffer({
            selling: StellarSdk.Asset.native(),
            buying: LAAM_ASSET,
            buyAmount: amount.toString(),
            price: (1/price).toString(), // Price is inverted for manageBuyOffer
            offerId: 0
          });
        } else {
          // Sell Laam for XLM
          operation = StellarSdk.Operation.manageSellOffer({
            selling: LAAM_ASSET,
            buying: StellarSdk.Asset.native(),
            amount: amount.toString(),
            price: price.toString(),
            offerId: 0
          });
        }
        
        const transaction = new StellarSdk.TransactionBuilder(account, {
          fee: StellarSdk.BASE_FEE,
          networkPassphrase: StellarSdk.Networks.PUBLIC
        })
        .addOperation(operation)
        .setTimeout(30)
        .build();
        
        transaction.sign(currentKeypair);
        
        const result = await server.submitTransaction(transaction);
        console.log('Order placed successfully:', result);
        
        showSuccess(`${currentTradeMode === 'buy' ? 'Buy' : 'Sell'} order placed successfully!`);
        closeTradeModal();
        
        // Refresh data
        await loadWallet();
        fetchOrderbook();
        
      } catch (error) {
        console.error('Error placing order:', error);
        showError('Failed to place order: ' + error.message);
      }
    }

    // My Orders Modal functions
    function openMyOrdersModal() {
      const modal = document.getElementById('myOrdersModal');
      modal.classList.add('show');
      loadMyOrders();
    }

    function closeMyOrdersModal() {
      document.getElementById('myOrdersModal').classList.remove('show');
    }

    async function loadMyOrders() {
      if (!currentKeypair) return;
      
      try {
        const ordersList = document.getElementById('ordersList');
        ordersList.innerHTML = '<div class="loading-spinner"></div> Loading your orders...';
        
        const account = await server.loadAccount(currentKeypair.publicKey());
        const offers = account.offers;
        
        if (offers.length === 0) {
          ordersList.innerHTML = '<div style="text-align:center; padding:20px; color:var(--muted);">No active orders found</div>';
          return;
        }
        
        ordersList.innerHTML = '';
        
        offers.forEach(offer => {
          const orderItem = document.createElement('div');
          orderItem.className = 'order-item';
          
          let type = 'Unknown';
          let amount = 0;
          let price = 0;
          
          if (offer.selling.asset_type === 'native' && 
              offer.buying.asset_code === LAAM_TOKEN.code && 
              offer.buying.asset_issuer === LAAM_TOKEN.issuer) {
            // Buying Laam with XLM
            type = 'BUY';
            amount = parseFloat(offer.amount);
            price = 1 / parseFloat(offer.price); // Invert price for buy orders
          } else if (offer.selling.asset_code === LAAM_TOKEN.code && 
                     offer.selling.asset_issuer === LAAM_TOKEN.issuer && 
                     offer.buying.asset_type === 'native') {
            // Selling Laam for XLM
            type = 'SELL';
            amount = parseFloat(offer.amount);
            price = parseFloat(offer.price);
          } else {
            // Skip other assets
            return;
          }
          
          orderItem.innerHTML = `
            <div class="order-type ${type.toLowerCase()}">${type}</div>
            <div class="order-amount">${amount.toFixed(2)} Laam</div>
            <div class="order-price">${price.toFixed(7)} XLM</div>
          `;
          
          orderItem.addEventListener('click', () => {
            document.querySelectorAll('.order-item').forEach(item => item.classList.remove('selected'));
            orderItem.classList.add('selected');
            
            currentOfferId = offer.id;
            currentOfferType = type;
          });
          
          ordersList.appendChild(orderItem);
        });
        
      } catch (error) {
        console.error('Error loading orders:', error);
        document.getElementById('ordersList').innerHTML = 
          '<div style="text-align:center; padding:20px; color:var(--err);">Error loading orders</div>';
      }
    }

    function promptEditOffer() {
      if (!currentOfferId) {
        showError('Please select an order to edit');
        return;
      }
      
      const modal = document.getElementById('editOrderModal');
      modal.classList.add('show');
      
      // Pre-fill with current values
      const selectedOrder = document.querySelector('.order-item.selected');
      if (selectedOrder) {
        const amount = selectedOrder.querySelector('.order-amount').textContent.split(' ')[0];
        const price = selectedOrder.querySelector('.order-price').textContent.split(' ')[0];
        
        document.getElementById('editAmount').value = amount;
        document.getElementById('editPrice').value = price;
      }
    }

    function closeEditModal() {
      document.getElementById('editOrderModal').classList.remove('show');
    }

    async function confirmEditOffer() {
      const newAmount = parseFloat(document.getElementById('editAmount').value);
      const newPrice = parseFloat(document.getElementById('editPrice').value);
      
      if (!newAmount || !newPrice) {
        showError('Please enter both amount and price');
        return;
      }
      
      try {
        // First cancel the existing offer
        await cancelOffer(currentOfferId);
        
        // Then create a new one with updated values
        const account = await server.loadAccount(currentKeypair.publicKey());
        
        let operation;
        if (currentOfferType === 'BUY') {
          operation = StellarSdk.Operation.manageBuyOffer({
            selling: StellarSdk.Asset.native(),
            buying: LAAM_ASSET,
            buyAmount: newAmount.toString(),
            price: (1/newPrice).toString(),
            offerId: 0
          });
        } else {
          operation = StellarSdk.Operation.manageSellOffer({
            selling: LAAM_ASSET,
            buying: StellarSdk.Asset.native(),
            amount: newAmount.toString(),
            price: newPrice.toString(),
            offerId: 0
          });
        }
        
        const transaction = new StellarSdk.TransactionBuilder(account, {
          fee: StellarSdk.BASE_FEE,
          networkPassphrase: StellarSdk.Networks.PUBLIC
        })
        .addOperation(operation)
        .setTimeout(30)
        .build();
        
        transaction.sign(currentKeypair);
        await server.submitTransaction(transaction);
        
        showSuccess('Order updated successfully!');
        closeEditModal();
        closeMyOrdersModal();
        
        // Refresh data
        await loadWallet();
        fetchOrderbook();
        
      } catch (error) {
        console.error('Error updating order:', error);
        showError('Failed to update order: ' + error.message);
      }
    }

    async function confirmCancelOffer() {
      if (!currentOfferId) {
        showError('Please select an order to cancel');
        return;
      }
      
      try {
        await cancelOffer(currentOfferId);
        showSuccess('Order cancelled successfully!');
        closeMyOrdersModal();
        
        // Refresh data
        await loadWallet();
        fetchOrderbook();
        
      } catch (error) {
        console.error('Error cancelling order:', error);
        showError('Failed to cancel order: ' + error.message);
      }
    }

    async function cancelOffer(offerId) {
      const account = await server.loadAccount(currentKeypair.publicKey());
      
      const operation = StellarSdk.Operation.manageSellOffer({
        selling: StellarSdk.Asset.native(),
        buying: StellarSdk.Asset.native(),
        amount: '0',
        price: '1',
        offerId: offerId
      });
      
      const transaction = new StellarSdk.TransactionBuilder(account, {
        fee: StellarSdk.BASE_FEE,
        networkPassphrase: StellarSdk.Networks.PUBLIC
      })
      .addOperation(operation)
      .setTimeout(30)
      .build();
      
      transaction.sign(currentKeypair);
      await server.submitTransaction(transaction);
    }

    // Swap trade assets
    function swapTradeAssets() {
      // In a real app, this would switch the trading pair
      showSuccess('Swapped trading assets');
    }

    // Watch deposits for the account
    async function watchDeposits() {
      if (!currentKeypair || !server) return;
      
      try {
        const accountId = currentKeypair.publicKey();
        
        // Check for new transactions periodically
        setInterval(async () => {
          try {
            const account = await server.loadAccount(accountId);
            const lastBalance = parseFloat(localStorage.getItem('last_balance') || '0');
            const currentBalance = account.balances.find(b => b.asset_type === 'native').balance;
            
            if (parseFloat(currentBalance) > lastBalance) {
              showSuccess('New deposit received!');
              localStorage.setItem('last_balance', currentBalance);
              await updateBalanceDisplay();
            }
          } catch (error) {
            console.error('Error checking deposits:', error);
          }
        }, 30000); // Check every 30 seconds
        
      } catch (error) {
        console.error('Error setting up deposit watcher:', error);
      }
    }

    // Add trustline for Laam token
    async function addTrustline() {
      if (!currentKeypair) {
        showError('Please unlock your wallet first');
        return;
      }

      try {
        const account = await server.loadAccount(currentKeypair.publicKey());
        
        // Check if trustline already exists
        const hasTrustline = account.balances.some(balance => 
          balance.asset_type === 'credit_alphanum4' && 
          balance.asset_code === LAAM_TOKEN.code && 
          balance.asset_issuer === LAAM_TOKEN.issuer
        );
        
        if (hasTrustline) {
          showError('Trustline for Laam token already exists');
          return;
        }
        
        const operation = StellarSdk.Operation.changeTrust({
          asset: LAAM_ASSET,
          limit: '10000000' // 10 million Laam limit
        });
        
        const transaction = new StellarSdk.TransactionBuilder(account, {
          fee: StellarSdk.BASE_FEE,
          networkPassphrase: StellarSdk.Networks.PUBLIC
        })
        .addOperation(operation)
        .setTimeout(30)
        .build();
        
        transaction.sign(currentKeypair);
        
        const result = await server.submitTransaction(transaction);
        console.log('Trustline added successfully:', result);
        
        showSuccess('Laam trustline added successfully!');
        await updateBalanceDisplay();
        
      } catch (error) {
        console.error('Error adding trustline:', error);
        showError('Failed to add trustline: ' + error.message);
      }
    }

    // Add trustline for USDC token
    async function addUSDCTrustline() {
      if (!currentKeypair) {
        showError('Please unlock your wallet first');
        return;
      }

      try {
        const account = await server.loadAccount(currentKeypair.publicKey());
        
        // Check if trustline already exists
        const hasTrustline = account.balances.some(balance => 
          balance.asset_type === 'credit_alphanum4' && 
          balance.asset_code === USDC_TOKEN.code && 
          balance.asset_issuer === USDC_TOKEN.issuer
        );
        
        if (hasTrustline) {
          showError('Trustline for USDC token already exists');
          return;
        }
        
        const operation = StellarSdk.Operation.changeTrust({
          asset: USDC_ASSET,
          limit: '10000000' // 10 million USDC limit
        });
        
        const transaction = new StellarSdk.TransactionBuilder(account, {
          fee: StellarSdk.BASE_FEE,
          networkPassphrase: StellarSdk.Networks.PUBLIC
        })
        .addOperation(operation)
        .setTimeout(30)
        .build();
        
        transaction.sign(currentKeypair);
        
        const result = await server.submitTransaction(transaction);
        console.log('USDC trustline added successfully:', result);
        
        showSuccess('USDC trustline added successfully!');
        await updateBalanceDisplay();
        
      } catch (error) {
        console.error('Error adding USDC trustline:', error);
        showError('Failed to add USDC trustline: ' + error.message);
      }
    }

    // Send asset function
    async function sendAsset(assetCode, amount, destination, memo = '') {
      if (!currentKeypair) {
        showError('Please unlock your wallet first');
        return;
      }

      try {
        const account = await server.loadAccount(currentKeypair.publicKey());
        
        let asset;
        if (assetCode === 'XLM') {
          asset = StellarSdk.Asset.native();
        } else if (assetCode === 'LAAM') {
          asset = LAAM_ASSET;
        } else if (assetCode === 'USDC') {
          asset = USDC_ASSET;
        } else {
          showError('Unsupported asset: ' + assetCode);
          return;
        }
        
        let operation = StellarSdk.Operation.payment({
          destination: destination,
          asset: asset,
          amount: amount.toString()
        });
        
        const transactionBuilder = new StellarSdk.TransactionBuilder(account, {
          fee: StellarSdk.BASE_FEE,
          networkPassphrase: StellarSdk.Networks.PUBLIC
        });
        
        if (memo) {
          transactionBuilder.addMemo(StellarSdk.Memo.text(memo));
        }
        
        const transaction = transactionBuilder
          .addOperation(operation)
          .setTimeout(30)
          .build();
        
        transaction.sign(currentKeypair);
        
        const result = await server.submitTransaction(transaction);
        console.log('Transaction submitted:', result);
        
        showSuccess(`${amount} ${assetCode} sent successfully!`);
        await updateBalanceDisplay();
        
        return result;
        
      } catch (error) {
        console.error('Error sending asset:', error);
        showError('Failed to send transaction: ' + error.message);
        throw error;
      }
    }

    // Generate QR code for receiving
    function generateReceiveQR() {
      if (!currentKeypair) {
        showError('Please unlock your wallet first');
        return;
      }

      const address = currentKeypair.publicKey();
      
      // In a real app, you would use a QR code library
      // For now, we'll just show the address
      alert(`Your Stellar address:\n${address}\n\nShare this address to receive payments.`);
    }

    // Lock wallet function
    function lockWallet() {
      currentKeypair = null;
      document.getElementById('loggedInView').classList.add('hidden');
      document.getElementById('authSection').classList.remove('hidden');
      document.getElementById('initialView').classList.add('hidden');
      document.getElementById('unlockView').classList.remove('hidden');
      
      // Clear password field
      document.getElementById('walletPassword').value = '';
      
      showSuccess('Wallet locked successfully');
    }

    // Reset wallet function
    function resetWallet() {
      if (confirm('Are you sure you want to reset? This will remove your current wallet from this device.')) {
        localStorage.removeItem('laam_wallet_key');
        localStorage.removeItem('laam_wallet_public');
        localStorage.removeItem('laam_wallet_biometric_fallback');
        currentKeypair = null;
        
        document.getElementById('unlockView').classList.add('hidden');
        document.getElementById('initialView').classList.remove('hidden');
        document.getElementById('walletPassword').value = '';
        document.getElementById('secretKeyInput').value = '';
        document.getElementById('savePasswordInput').value = '';
        
        showSuccess('Wallet reset successfully. You can now import a new wallet.');
      }
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, initializing app...');
      
      // Initialize Stellar SDK
      initializeStellar();
      initializeAssets();
      
      // Check for saved wallet
      checkSavedWallet();
      
      // Tab event listeners
      document.getElementById('overviewTab').addEventListener('click', () => switchTab('overview'));
      document.getElementById('orderbookTab').addEventListener('click', () => switchTab('orderbook'));
      document.getElementById('lastTradesTab').addEventListener('click', () => switchTab('lastTrades'));
      
      // Trade modal event listeners
      document.getElementById('btnBuy').addEventListener('click', () => openTradeModal('buy'));
      document.getElementById('btnSell').addEventListener('click', () => openTradeModal('sell'));
      document.getElementById('modalBuyBtn').addEventListener('click', placeOrder);
      
      // Input event listeners for trade modal
      document.getElementById('modalPrice').addEventListener('input', calculateTotal);
      document.getElementById('modalAmount').addEventListener('input', calculateTotal);
      
      // Percentage buttons
      document.querySelectorAll('.rowBtns button').forEach(button => {
        button.addEventListener('click', (e) => {
          const percentage = parseInt(e.target.getAttribute('data-fill'));
          fillPercentage(percentage);
        });
      });
      
      // My orders modal
      document.getElementById('confirmEditBtn').addEventListener('click', confirmEditOffer);
      
      // Action buttons
      document.getElementById('btnSend').addEventListener('click', () => {
        openSendWizard();
      });
      
      document.getElementById('btnReceive').addEventListener('click', generateReceiveQR);
      
      document.getElementById('addTrustlineBtn').addEventListener('click', () => {
        // Show trustline options
        if (confirm('Add trustline for Laam token? This is required to hold Laam tokens.')) {
          addTrustline();
        }
      });
      
      document.getElementById('logoutBtn').addEventListener('click', lockWallet);
      
      // Auth event listeners
      document.getElementById('importAndSaveBtn').addEventListener('click', importAndSaveWallet);
      document.getElementById('generateAccountBtn').addEventListener('click', generateNewAccount);
      document.getElementById('unlockBtn').addEventListener('click', unlockWallet);
      document.getElementById('resetWalletLink').addEventListener('click', resetWallet);
      
      // Asset item click event for token modal
      document.querySelectorAll('.asset-item').forEach(item => {
        item.addEventListener('click', () => {
          const token = item.getAttribute('data-token');
          openTokenModal(token);
        });
      });
      
      console.log('Event listeners initialized');
    });

    // Import and save wallet
    async function importAndSaveWallet() {
      const secretKey = document.getElementById('secretKeyInput').value.trim();
      const password = document.getElementById('savePasswordInput').value;
      
      if (!secretKey) {
        showError('Please enter your secret key');
        return;
      }
      
      if (!password || password.length < 8) {
        showError('Please enter a password with at least 8 characters');
        return;
      }
      
      try {
        // Validate the secret key
        const keypair = StellarSdk.Keypair.fromSecret(secretKey);
        
        // Test if the account exists
        try {
          await server.loadAccount(keypair.publicKey());
        } catch (error) {
          if (error.response && error.response.status === 404) {
            showError('Account not found on the network. Please make sure the account exists and is funded.');
            return;
          } else {
            throw error;
          }
        }
        
        // Encrypt and save the secret key
        const encryptedKey = encryptSecretKey(secretKey, password);
        localStorage.setItem('laam_wallet_key', encryptedKey);
        localStorage.setItem('laam_wallet_public', keypair.publicKey());
        
        // Store a fallback for biometric auth
        const biometricCompatibleKey = CryptoJS.SHA256(keypair.publicKey() + "biometric_fallback").toString();
        const biometricEncryptedKey = encryptSecretKey(secretKey, biometricCompatibleKey);
        localStorage.setItem('laam_wallet_biometric_fallback', biometricEncryptedKey);
        
        currentKeypair = keypair;
        
        // Show logged in view
        document.getElementById('authSection').classList.add('hidden');
        document.getElementById('loggedInView').classList.remove('hidden');
        
        showSuccess('Wallet imported and saved successfully!');
        
        // Load wallet data
        await loadWallet();
        watchDeposits();
        
      } catch (error) {
        console.error('Error importing wallet:', error);
        showError('Failed to import wallet: Invalid secret key or network error');
      }
    }

    // Generate new account
    function generateNewAccount() {
      try {
        generatedKeypair = StellarSdk.Keypair.random();
        
        openKeyModal(
          generatedKeypair.secret(),
          generatedKeypair.publicKey()
        );
        
      } catch (error) {
        console.error('Error generating account:', error);
        showError('Failed to generate new account: ' + error.message);
      }
    }

    // Unlock wallet
    async function unlockWallet() {
      const password = document.getElementById('walletPassword').value;
      const encryptedKey = localStorage.getItem('laam_wallet_key');
      
      if (!encryptedKey) {
        showError('No saved wallet found. Please import a wallet first.');
        return;
      }
      
      if (!password) {
        showError('Please enter your password');
        return;
      }
      
      try {
        const secretKey = decryptSecretKey(encryptedKey, password);
        
        if (!secretKey) {
          showError('Invalid password');
          return;
        }
        
        const keypair = StellarSdk.Keypair.fromSecret(secretKey);
        
        // Verify the account exists
        try {
          await server.loadAccount(keypair.publicKey());
        } catch (error) {
          if (error.response && error.response.status === 404) {
            showError('Account not found on the network');
            return;
          } else {
            throw error;
          }
        }
        
        currentKeypair = keypair;
        
        // Show logged in view
        document.getElementById('authSection').classList.add('hidden');
        document.getElementById('loggedInView').classList.remove('hidden');
        
        showSuccess('Wallet unlocked successfully!');
        
        // Load wallet data
        await loadWallet();
        watchDeposits();
        
      } catch (error) {
        console.error('Error unlocking wallet:', error);
        showError('Failed to unlock wallet: ' + error.message);
      }
    }

    // Token Modal functions
    function openTokenModal(token) {
      if (!currentKeypair) return;
      
      const modal = document.getElementById('tokenModal');
      const tokenName = document.getElementById('modalTokenName');
      const tokenIcon = document.getElementById('modalTokenIcon');
      const tokenBalance = document.getElementById('modalTokenBalance');
      const tokenValue = document.getElementById('modalTokenValue');
      
      let balance = '0';
      let value = '$0.00';
      let icon = '';
      let name = '';
      
      switch(token) {
        case 'XLM':
          balance = document.getElementById('xlmBal').textContent + ' XLM';
          value = '$' + document.getElementById('xlmBalUsd').textContent;
          icon = 'https://res.coinpaper.com/coinpaper/stellar_xlm_logo_07021d63c0.png';
          name = 'Stellar Lumens';
          break;
        case 'LAAM':
          balance = document.getElementById('laamBal').textContent + ' Laam';
          value = '$' + document.getElementById('laamBalUsd').textContent;
          icon = 'https://i.ibb.co/r28SP1bN/20250802-225108.png';
          name = 'Laam Token';
          break;
        case 'USDC':
          balance = document.getElementById('usdcBal').textContent + ' USDC';
          value = '$' + document.getElementById('usdcBalUsd').textContent;
          icon = 'https://i.ibb.co/r2qNFs22/images-2.png';
          name = 'USD Coin';
          break;
      }
      
      tokenName.textContent = name;
      tokenIcon.src = icon;
      tokenBalance.textContent = balance;
      tokenValue.textContent = value;
      
      modal.classList.add('show');
    }

    function closeTokenModal() {
      document.getElementById('tokenModal').classList.remove('show');
    }

    function openSendWizardForToken() {
      const tokenName = document.getElementById('modalTokenName').textContent;
      let assetCode = 'XLM';
      
      if (tokenName.includes('Laam')) {
        assetCode = 'LAAM';
      } else if (tokenName.includes('USD Coin')) {
        assetCode = 'USDC';
      }
      
      closeTokenModal();
      openSendWizard(assetCode);
    }

    function openReceiveForToken() {
      closeTokenModal();
      generateReceiveQR();
    }

    // Send Wizard functions
    function openSendWizard(prefilledAsset = null) {
      document.getElementById('sendWizard').style.display = 'block';
      document.getElementById('wizardOverlay').style.display = 'block';
      
      // Reset wizard
      document.querySelectorAll('.wizard-step').forEach(step => step.style.display = 'none');
      document.getElementById('step1').style.display = 'block';
      document.getElementById('wizardError').style.display = 'none';
      
      // Clear all inputs
      document.getElementById('sendAsset').value = '';
      document.getElementById('sendAmount').value = '';
      document.getElementById('sendDest').value = '';
      document.getElementById('sendMemo').value = '';
      
      // Pre-fill asset if provided
      if (prefilledAsset) {
        document.getElementById('sendAsset').value = prefilledAsset;
      }
    }

    function closeWizard() {
      document.getElementById('sendWizard').style.display = 'none';
      document.getElementById('wizardOverlay').style.display = 'none';
    }

    function nextStep(step) {
      // Validate current step before proceeding
      if (step === 2) {
        const asset = document.getElementById('sendAsset').value;
        if (!asset) {
          showWizardError('Please select an asset to send');
          return;
        }
      } else if (step === 3) {
        const amount = document.getElementById('sendAmount').value;
        if (!amount || parseFloat(amount) <= 0) {
          showWizardError('Please enter a valid amount');
          return;
        }
      } else if (step === 4) {
        const dest = document.getElementById('sendDest').value;
        if (!dest || !StellarSdk.StrKey.isValidEd25519PublicKey(dest)) {
          showWizardError('Please enter a valid Stellar address');
          return;
        }
      }
      
      // Hide all steps
      document.querySelectorAll('.wizard-step').forEach(step => step.style.display = 'none');
      
      // Show target step
      document.getElementById('step' + step).style.display = 'block';
      
      // If moving to confirmation step, populate the confirmation details
      if (step === 5) {
        document.getElementById('confirmAsset').textContent = document.getElementById('sendAsset').value;
        document.getElementById('confirmAmount').textContent = document.getElementById('sendAmount').value + ' ' + document.getElementById('sendAsset').value;
        document.getElementById('confirmDest').textContent = document.getElementById('sendDest').value;
        document.getElementById('confirmMemo').textContent = document.getElementById('sendMemo').value || 'None';
      }
      
      // Hide error if validation passed
      document.getElementById('wizardError').style.display = 'none';
    }

    function showWizardError(message) {
      const errorElement = document.getElementById('wizardError');
      errorElement.textContent = message;
      errorElement.style.display = 'block';
    }

    async function sendTransaction() {
      const asset = document.getElementById('sendAsset').value;
      const amount = document.getElementById('sendAmount').value;
      const destination = document.getElementById('sendDest').value;
      const memo = document.getElementById('sendMemo').value;
      
      try {
        // Show loading state
        document.getElementById('confirmSendBtn').textContent = 'Sending...';
        document.getElementById('confirmSendBtn').disabled = true;
        
        const result = await sendAsset(asset, amount, destination, memo);
        
        // Show success step
        document.querySelectorAll('.wizard-step').forEach(step => step.style.display = 'none');
        document.getElementById('step6').style.display = 'block';
        
        // Populate receipt
        document.getElementById('receiptDest').textContent = destination;
        document.getElementById('receiptHash').textContent = result.hash;
        document.getElementById('receiptHash').href = `https://stellar.expert/explorer/public/tx/${result.hash}`;
        document.getElementById('receiptAmount').textContent = amount + ' ' + asset;
        document.getElementById('receiptDate').textContent = new Date().toLocaleString();
        
      } catch (error) {
        showWizardError('Failed to send transaction: ' + error.message);
        document.getElementById('confirmSendBtn').textContent = 'Send Now';
        document.getElementById('confirmSendBtn').disabled = false;
      }
    }

    // QR Code scanning (placeholder - would need a QR library in a real implementation)
    document.getElementById('scanQRBtn').addEventListener('click', function() {
      alert('QR scanning would be implemented here with a proper library');
      // In a real implementation, this would open the camera for QR scanning
    });

    // Initialize everything when the page loads
    window.addEventListener('load', function() {
      console.log('Page fully loaded');
      
      // Set up timeframe buttons
      document.querySelectorAll('.timeframe-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          document.querySelectorAll('.timeframe-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          
          // In a real app, this would update the chart data
          console.log('Timeframe changed to:', this.getAttribute('data-timeframe'));
        });
      });
      
      // Set initial active tab
      switchTab('orderbook');
      
      console.log('App initialization complete');
    });

// === FINGERPRINT AUTHENTICATION SYSTEM ===
class FingerprintAuth {
  constructor() {
    this.isSupported = false;
    this.isSetup = false;
    this.credentialId = null;
    this.publicKey = null;
    this.init();
  }

  init() {
    // Check if WebAuthn is supported
    if (window.PublicKeyCredential) {
      this.isSupported = true;
      this.loadStoredCredential();
      console.log('WebAuthn fingerprint authentication supported');
    } else {
      console.log('WebAuthn not supported in this browser');
    }
  }

  loadStoredCredential() {
    const storedCredential = localStorage.getItem('laam_webauthn_credential');
    if (storedCredential) {
      const credentialData = JSON.parse(storedCredential);
      this.credentialId = credentialData.credentialId;
      this.publicKey = credentialData.publicKey;
      this.isSetup = true;
      
      // Update UI to show fingerprint is set up
      document.getElementById('fingerprintStatus').textContent = 'Fingerprint unlock ready';
      document.getElementById('fingerprintStatus').className = 'fingerprint-status enabled';
      document.getElementById('fingerprintUnlockBtn').disabled = false;
    }
  }

  async register() {
    if (!this.isSupported) {
      showError('Fingerprint authentication is not supported in your browser');
      return false;
    }

    try {
      // Generate a new key pair for the user
      const publicKey = {
        challenge: new Uint8Array(32),
        rp: {
          name: "Laam Wallet",
          id: window.location.hostname
        },
        user: {
          id: new Uint8Array(16),
          name: "laam-user",
          displayName: "Laam Wallet User"
        },
        pubKeyCredParams: [{alg: -7, type: "public-key"}],
        authenticatorSelection: {
          authenticatorAttachment: "platform",
          userVerification: "required"
        },
        timeout: 60000,
        attestation: "direct"
      };

      const credential = await navigator.credentials.create({ publicKey });
      
      if (credential) {
        // Store the credential ID and public key
        const credentialData = {
          credentialId: this.arrayToBase64(credential.rawId),
          publicKey: credential.response.getPublicKey()
        };
        
        localStorage.setItem('laam_webauthn_credential', JSON.stringify(credentialData));
        this.isSetup = true;
        
        // Update UI
        document.getElementById('fingerprintStatus').textContent = 'Fingerprint unlock ready';
        document.getElementById('fingerprintStatus').className = 'fingerprint-status enabled';
        document.getElementById('fingerprintUnlockBtn').disabled = false;
        
        showSuccess('Fingerprint authentication set up successfully!');
        return true;
      }
    } catch (error) {
      console.error('Error during fingerprint registration:', error);
      showError('Failed to set up fingerprint authentication: ' + error.message);
      return false;
    }
  }

  async authenticate() {
    if (!this.isSupported || !this.isSetup) {
      showError('Fingerprint authentication is not set up');
      return false;
    }

    try {
      // Show fingerprint scanner
      this.showScanner();
      
      const publicKey = {
        challenge: new Uint8Array(32),
        allowCredentials: [{
          id: this.base64ToArray(this.credentialId),
          type: "public-key"
        }],
        timeout: 60000,
        userVerification: "required"
      };

      const assertion = await navigator.credentials.get({ publicKey });
      
      if (assertion) {
        this.hideScanner();
        
        // Verify the assertion (in a real app, this would be verified server-side)
        const isValid = await this.verifyAssertion(assertion);
        
        if (isValid) {
          showSuccess('Fingerprint verified successfully!');
          
          // Unlock the wallet using the fallback key
          await this.unlockWithBiometric();
          return true;
        } else {
          showError('Fingerprint verification failed');
          return false;
        }
      }
    } catch (error) {
      this.hideScanner();
      console.error('Error during fingerprint authentication:', error);
      
      if (error.name === 'NotAllowedError') {
        showError('Fingerprint authentication was cancelled or not recognized');
      } else {
        showError('Fingerprint authentication failed: ' + error.message);
      }
      return false;
    }
  }

  async verifyAssertion(assertion) {
    // In a real implementation, this would verify the assertion with a server
    // For this demo, we'll assume it's valid if we get this far
    return true;
  }

  async unlockWithBiometric() {
    try {
      const fallbackKey = localStorage.getItem('laam_wallet_biometric_fallback');
      const publicKey = localStorage.getItem('laam_wallet_public');
      
      if (!fallbackKey || !publicKey) {
        showError('Biometric fallback not found. Please use password unlock.');
        return false;
      }
      
      // Derive the same key used during setup
      const biometricKey = CryptoJS.SHA256(publicKey + "biometric_fallback").toString();
      
      // Decrypt the secret key
      const secretKey = decryptSecretKey(fallbackKey, biometricKey);
      
      if (!secretKey) {
        showError('Biometric authentication failed. Secret key could not be decrypted.');
        return false;
      }
      
      const keypair = StellarSdk.Keypair.fromSecret(secretKey);
      
      // Verify the account exists
      try {
        await server.loadAccount(keypair.publicKey());
      } catch (error) {
        showError('Account not found on the network');
        return false;
      }
      
      currentKeypair = keypair;
      
      // Show logged in view
      document.getElementById('authSection').classList.add('hidden');
      document.getElementById('loggedInView').classList.remove('hidden');
      
      showSuccess('Wallet unlocked with fingerprint!');
      
      // Load wallet data
      await loadWallet();
      watchDeposits();
      
      return true;
      
    } catch (error) {
      console.error('Error during biometric unlock:', error);
      showError('Failed to unlock with fingerprint: ' + error.message);
      return false;
    }
  }

  showScanner() {
    const scanner = document.getElementById('fingerprintScanner');
    const animation = document.getElementById('scannerAnimation');
    const text = document.getElementById('scannerText');
    const subtext = document.getElementById('scannerSubtext');
    
    scanner.classList.add('active');
    animation.classList.add('scanning');
    text.textContent = 'Scanning Fingerprint';
    subtext.textContent = 'Please place your finger on the sensor';
  }

  hideScanner() {
    const scanner = document.getElementById('fingerprintScanner');
    const animation = document.getElementById('scannerAnimation');
    
    scanner.classList.remove('active');
    animation.classList.remove('scanning');
  }

  arrayToBase64(array) {
    return btoa(String.fromCharCode.apply(null, new Uint8Array(array)));
  }

  base64ToArray(base64) {
    const binaryString = atob(base64);
    const bytes = new Uint8Array(binaryString.length);
    for (let i = 0; i < binaryString.length; i++) {
      bytes[i] = binaryString.charCodeAt(i);
    }
    return bytes;
  }
}

// Initialize fingerprint authentication
const fingerprintAuth = new FingerprintAuth();

// Show fingerprint section if supported
if (fingerprintAuth.isSupported) {
  document.getElementById('fingerprintSection').style.display = 'block';
}

// Event listeners for fingerprint buttons
document.getElementById('setupFingerprintBtn').addEventListener('click', async () => {
  const success = await fingerprintAuth.register();
  if (success) {
    console.log('Fingerprint setup completed');
  }
});

document.getElementById('fingerprintUnlockBtn').addEventListener('click', async () => {
  const success = await fingerprintAuth.authenticate();
  if (success) {
    console.log('Fingerprint unlock successful');
  }
});

document.getElementById('cancelScan').addEventListener('click', () => {
  fingerprintAuth.hideScanner();
});
  </script>
</body>
</html>
